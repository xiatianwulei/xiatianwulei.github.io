
---
title: "ç§»åŠ¨ç«¯è·¨å¹³å°å¼€å‘ å­¦ä¹ æ•´ç†"
date: 2019-12-12T17:49:34+08:00
layout: "about"
---


# ç§»åŠ¨ç«¯è·¨å¹³å°å¼€å‘ å­¦ä¹ æ•´ç†

## ä¸€ ã€å‰è¨€
>   1.ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦è·¨å¹³å°å¼€å‘ï¼Ÿ æœ¬è´¨ä¸Šï¼Œè·¨å¹³å°å¼€å‘æ˜¯ä¸ºäº†å¢åŠ ä»£ç å¤ç”¨ï¼Œå‡å°‘å¼€å‘è€…å¯¹å¤šä¸ªå¹³å°å·®å¼‚é€‚é…çš„å·¥ä½œé‡ï¼Œé™ä½å¼€å‘æˆæœ¬ï¼Œæé«˜ä¸šåŠ¡ä¸“æ³¨çš„åŒæ—¶ï¼Œæä¾›æ¯”webæ›´å¥½çš„ä½“éªŒã€‚å—¯ï½é€šä¿—äº†è¯´å°±æ˜¯ï¼šçœé’±ã€å·æ‡’ã€‚
>   2.æœ¬ç¯‡ä¸»è¦ä»¥react-nativeã€flutterï¼ŒswitfUIç»“åˆèµ„è®¯å±•æœ›ï¼ŒèŠèŠå½“å‰è·¨å¹³å°ç§»åŠ¨å¼€å‘çš„å®ç°åŸç†ã€ç°çŠ¶ä¸æœªæ¥ã€‚
  
### å¸¸è§çš„å“ç‰Œå¼€å‘æ¨¡å¼ï¼š
 å¸¸è§çš„å¼€å‘æ¨¡å¼æœ‰5ç§ï¼ˆNative App,Web App,Hybrid App,Weex,React Nativeï¼‰
 
**1.ç¬¬ä¸€é˜¶æ®µ(Native App)**
*  Native App:æŒ‡ä½¿ç”¨åŸç”ŸAPIå¼€å‘App,æ¯”å¦‚iOSç”¨OCè¯­è¨€å¼€å‘
* ä¼˜ç‚¹ï¼šæ€§èƒ½é«˜
* ç¼ºç‚¹ï¼šå¼€å‘ç»´æŠ¤æˆæœ¬é«˜ï¼Œå…»ä¸€ä¸ªåŸç”Ÿå¼€å‘å·¥ç¨‹å¸ˆéœ€è¦å¾ˆå¤šé’±ï¼Œæœ€é‡è¦iOSç‰ˆæœ¬æ›´æ–°ä¹Ÿæˆé—®é¢˜ã€‚
![](/media/15635256320339/15638517464419.jpg)


 2.ç¬¬äºŒé˜¶æ®µ(Web App)
* Web App:æŒ‡ä½¿ç”¨Htmlå¼€å‘çš„ç§»åŠ¨ç«¯ç½‘é¡µApp,ç±»ä¼¼å¾®ä¿¡å°ç¨‹åºï¼Œæ•´ä¸ªAppéƒ½æ˜¯ç½‘é¡µã€‚(å°ç¨‹åº)
* ä¼˜ç‚¹ï¼šç”¨æˆ·ä¸éœ€è¦å®‰è£…ï¼Œä¸ä¼šå ç”¨æ‰‹æœºå†…å­˜
* ç¼ºç‚¹ï¼šç”¨æˆ·ä½“éªŒä¸å¥½ï¼Œä¸èƒ½ç¦»çº¿ï¼Œå¿…é¡»è”ç½‘
* ![](/media/15635256320339/15638519060251.jpg)


 3.Hybrid App
* Hybrid App:æ··åˆå¼€å‘æ¨¡å¼ï¼ŒåŸç”ŸApi+Htmlå…±åŒå¼€å‘ï¼Œæ¯”å¦‚iOS,ç”¨htmlå†™å¥½ç•Œé¢ï¼Œç”¨UIWebViewå±•ç¤ºã€‚
* ä¼˜ç‚¹:ç•Œé¢å¤ç”¨æ€§å¼ºï¼Œä¸€ä¸ªç•Œé¢ï¼ŒiOSå’Œå®‰å“éƒ½å¯ä»¥ä½¿ç”¨
* ç¼ºç‚¹:ç›¸å¯¹äºåŸç”Ÿï¼Œæ€§èƒ½ç›¸å¯¹æœ‰æ‰€æŸå®³

 4.ç¬¬ä¸‰é˜¶æ®µ(React Native )
*  React Native:åŸºäºReactå¼€å‘çš„App
* ä¼˜ç‚¹ï¼šè·¨å¹³å°å¼€å‘ è·³è¿‡App Storeå®¡æ ¸ï¼Œè¿œç¨‹æ›´æ–°ä»£ç ï¼Œæé«˜è¿­ä»£é¢‘ç‡å’Œæ•ˆç‡ï¼Œæ—¢æœ‰Nativeçš„ä½“éªŒï¼Œåˆä¿ç•™Reactçš„å¼€å‘æ•ˆç‡ã€‚
* ç¼ºç‚¹:RNçš„æ•´ä½“æ€æƒ³æ˜¯ä¸€å¤„å­¦ä¹ åˆ°å¤„ä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨Androidå’ŒIosçš„ä½¿ç”¨æ–¹å¼ä¸Šè¿˜æ˜¯æœ‰å·®å¼‚çš„ï¼Œè€Œä¸”åœ¨å¼€å‘æ’ä»¶çš„æ—¶å€™ï¼Œè¿˜æ˜¯éœ€è¦å¼€å‘android iosä¸¤å¥—æ’ä»¶ï¼Œèƒ½è¾¾åˆ°åƒH5ä¸€æ ·ï¼Œä¸€å¤„ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œè¿˜æ˜¯æœ‰å¾ˆå¤§çš„å·®å¼‚çš„ï¼Œæ‰€ä»¥é™¤äº†androidå’Œioså›¢é˜Ÿå¤–è¿˜éœ€è¦ä¸€ä¸ªå›¢é˜Ÿç»´æŠ¤RNï¼ŒRNæ¶æ„çš„ç»´æŠ¤æˆæœ¬è¦æ¯”androidå’Œiosçš„å¼€å‘çš„éš¾åº¦é«˜å¤šäº†ã€‚æ‰€ä»¥æˆæœ¬æ¯”åŸæ¥è¿˜é«˜ï¼Œè¿˜æœ‰å¾ˆå¤šRnæ¶æ„æœ¬èº«æ²¡æœ‰åŠæ³•ç»“å±€çš„é—®é¢˜ï¼Œå¯¹äºå°å›¢é˜Ÿæ¥è¯´ç®€ç›´å°±æ˜¯å™©æ¢¦ã€‚
* ![](/media/15635256320339/15638523423088.jpg)

 4.ç¬¬å››é˜¶æ®µ(Flutte)
 åœ¨ Flutter Live 2018 ä¸Šï¼ŒGoogle å®£å¸ƒ Flutter 1.0 æ­£å¼å‘å¸ƒã€‚è¿™æ˜¯ä¸€ä¸ªåŸºäº Dart çš„ç§»åŠ¨å¼€å‘å¹³å°ï¼Œå®˜æ–¹æƒ³å¸®åŠ©å¼€å‘è€…åœ¨ iOS å’Œ Android ä¸¤ä¸ªå¹³å°ä¸Šå¼€å‘é«˜è´¨é‡çš„åŸç”Ÿåº”ç”¨ç•Œé¢ã€‚æ­¤å¤–ï¼ŒGoogle è¿˜å®£å¸ƒäº† Flutter è¿è¡Œæ—¶åŸºäº Web çš„å®éªŒæ€§å®ç°ï¼Œæ—¨åœ¨å°† Flutter åº”ç”¨å¼•å…¥æ ‡å‡† Web æµè§ˆå™¨
![](/media/15635256320339/15638521079888.jpg)

ä¼˜ç‚¹:å®ƒåœ¨ç¬¬ä¸‰é˜¶æ®µçš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†ä¸€ä¸ªdartè™šæ‹Ÿæœºï¼Œæ‰€ä»¥å‡å°‘äº†æ¡¥çš„äº¤äº’ï¼Œæ‰€ä»¥æ€§èƒ½æ–¹é¢ä¼šæ›´åŠ ä¼˜ç§€ï¼Œè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯ç»´æŠ¤ä¸Šï¼Œflutteræœ‰Googleç»´æŠ¤ï¼Œæ‰€ä»¥ä»–çš„æ’ä»¶å¼€å‘å°†ä¼šæ›´åŠ è§„èŒƒï¼Œæ‰€ä»¥ç†è®ºä¸Šå¾ˆå®¹æ˜“å®ç°è·¨å¹³å°ä»£ç å¤ç”¨çš„æƒ…å†µ
ç¼ºç‚¹:ä¸€ä¸ªæŠ€æœ¯èƒ½å¦æ´»ä¸‹æ¥æœ‰å¾ˆå¤šåŸå› ï¼ŒæŠ€æœ¯å¥½ä¸ä¸€å®šä¼šç«ï¼Œæ‰€ä»¥æˆ‘å¹¶ä¸è§‰å¾—flutterä¸€å®šä¼šç«ï¼Œä½†æˆ‘è®¤ä¸ºå³ä½¿ä¸æ˜¯ flutter ä¹Ÿä¼šæœ‰ä¸€ä¸ªç±»ä¼¼äº flutterçš„ç¬¬å››é˜¶æ®µçš„æŠ€æœ¯æ–¹å¼æ¥è§£å†³ç›®å‰ç§»åŠ¨å¼€å‘çš„ç—›ç‚¹ç›®å‰ Flutter éšœç¢åœ¨äºï¼šåœ¨iOSæ™®åŠä¸Šæœ‰æå¤§çš„éšœç¢ æ€§èƒ½æ²¡æœ‰æ¯”åŸç”Ÿæ”¹å–„ æ— æ³•æ”¯æŒçƒ­æ›´

## äºŒã€åˆ†äº«çš„ä¸»è¦å†…å®¹
-------
## 1ã€React Native
### 1.1ã€ç†å¿µæ¶æ„

   â€œLearn once, write anywhereâ€ ï¼Œä»£è¡¨ç€ Facebookå¯¹ react native çš„å®šä¹‰ï¼šå­¦ä¹  react ï¼ŒåŒæ—¶æŒæ¡ web ä¸ app ä¸¤ç§å¼€å‘æŠ€èƒ½ã€‚ react native  ç”¨äº† react çš„è®¾è®¡æ¨¡å¼ï¼Œä½†UIæ¸²æŸ“ã€åŠ¨ç”»æ•ˆæœã€ç½‘ç»œè¯·æ±‚ç­‰å‡ç”±åŸç”Ÿç«¯å®ç°ã€‚å¼€å‘è€…ç¼–å†™çš„jsä»£ç ï¼Œé€šè¿‡ react native çš„ä¸­é—´å±‚è½¬åŒ–ä¸ºåŸç”Ÿæ§ä»¶å’Œæ“ä½œï¼Œæ¯”ionicç­‰è·¨å¹³å°åº”ç”¨ï¼Œå¤§å¤§æé«˜äº†çš„ç”¨æˆ·ä½“éªŒã€‚

**â€ƒæ€»ç»“èµ·æ¥å…¶å®å°±æ˜¯åˆ©ç”¨ JS æ¥è°ƒç”¨ Native ç«¯çš„ç»„ä»¶ï¼Œä»è€Œå®ç°ç›¸åº”çš„åŠŸèƒ½ã€‚**

### 1.2ã€åŸç†
React Nativeä¼šåœ¨ä¸€å¼€å§‹ç”ŸæˆOCæ¨¡å—è¡¨ï¼Œç„¶åæŠŠè¿™ä¸ªæ¨¡å—è¡¨ä¼ å…¥JSä¸­ï¼ŒJSå‚ç…§æ¨¡å—è¡¨ï¼Œå°±èƒ½é—´æ¥è°ƒç”¨OCçš„ä»£ç ã€‚
ç›¸å½“äºä¹°äº†ä¸€ä¸ªæœºå™¨äººï¼ˆOCï¼‰ï¼Œå¯¹åº”ä¸€ä»½è¯´æ˜ä¹¦ï¼ˆæ¨¡å—è¡¨ï¼‰ï¼Œç”¨æˆ·ï¼ˆJSï¼‰å‚ç…§è¯´æ˜ä¹¦å»æ‰§è¡Œæœºå™¨äººçš„æ“ä½œ
React Nativeéœ€è¦iOS,å®‰å“éƒ½å†™ï¼Œè¯´æ˜React Nativeåº•å±‚è§£æåŸç”ŸAPIæ˜¯åˆ†å¼€å®ç°çš„ï¼ŒiOSä¸€å¥—ï¼Œå®‰å“ä¸€å¥—ã€‚![](/media/15635256320339/15637647852802.jpg)

### 1.3 äº¤äº’
#### React Nativeæ˜¯å¦‚ä½•åšåˆ°JSå’ŒOCäº¤äº’
* 1.é¦–å…ˆå†™å¥½JSXä»£ç ï¼ˆReactæ¡†æ¶å°±æ˜¯ä½¿ç”¨JSXè¯­æ³•ï¼‰
* 2.æŠŠJSXä»£ç è§£ææˆjavaScriptä»£ç 
* 3.OCè¯»å–JSæ–‡ä»¶
* 4.æŠŠjavaScriptä»£ç è¯»å–å‡ºæ¥ï¼Œåˆ©ç”¨JavaScriptCoreæ‰§è¡Œ
* 5.javaScriptä»£ç è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­ä¼šæè¿°OCå¯¹è±¡ï¼ŒOCå¯¹è±¡çš„å±æ€§ï¼ŒOCå¯¹è±¡æ‰€éœ€è¦æ‰§è¡Œçš„æ–¹æ³•ï¼Œè¿™æ ·å°±èƒ½è®©è¿™ä¸ªå¯¹è±¡è®¾ç½®å±æ€§ï¼Œå¹¶ä¸”è°ƒç”¨æ–¹æ³•ã€‚

```
è¡¥å……:JavaScriptCore æ˜¯iOSåŸç”ŸAPI,
JSContext: JSè¿è¡Œç¯å¢ƒï¼Œç”¨å®ƒå»æ‰§è¡ŒJSä»£ç ï¼Œå¹¶ä¸”é€šè¿‡å®ƒå»è·å–JSé‡Œçš„æ•°æ®
JSValue: ç”¨äºæ¥æ”¶JSä¸­è·å–çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥æ˜¯ä»»ä¸€å¯¹è±¡ï¼Œæ–¹æ³•ã€‚
```
![](/media/15635256320339/15637634059269.jpg)


#### 1.3 React Nativeå¯åŠ¨æµç¨‹(iOS)
* 1.åˆ›å»ºRCTRootView -> è®¾ç½®çª—å£æ ¹æ§åˆ¶å™¨çš„View,æŠŠRNçš„Viewæ·»åŠ åˆ°çª—å£ä¸Šæ˜¾ç¤ºã€‚
* 2.åˆ›å»ºRCTBridge -> æ¡¥æ¥å¯¹è±¡,ç®¡ç†JSå’ŒOCäº¤äº’ï¼Œåšä¸­è½¬å·¦å³ã€‚
* 3.åˆ›å»ºRCTBatchedBridge -> æ‰¹é‡æ¡¥æ¶å¯¹è±¡ï¼ŒJSå’ŒOCäº¤äº’å…·ä½“å®ç°éƒ½åœ¨è¿™ä¸ªç±»ä¸­ã€‚
* 4.æ‰§è¡Œ[RCTBatchedBridge loadSource] -> åŠ è½½JSæºç 
* 5.æ‰§è¡Œ[RCTBatchedBridge initModulesWithDispatchGroup] -> åˆ›å»ºOCæ¨¡å—è¡¨
* 6.æ‰§è¡Œ[RCTJSCExecutor injectJSONText] -> å¾€JSä¸­æ’å…¥OCæ¨¡å—è¡¨
* 7.æ‰§è¡Œå®ŒJSä»£ç ï¼Œå›è°ƒOCï¼Œè°ƒç”¨OCä¸­çš„ç»„ä»¶
* 8.å®ŒæˆUIæ¸²æŸ“

![](/media/15635256320339/15637640099730.jpg)


### 1.4 React NativeåŠ è½½JSæºç æµç¨‹(iOS)

1.[RCTJavaScriptLoader loadBundleAtURL] -> åŠ è½½è¿œç¨‹æœåŠ¡å™¨ä¸­JSä»£ç 
2.attemptAsynchronousLoadOfBundleAtURL(Cå‡½æ•°) -> å¼€å¯å¼‚æ­¥åŠ è½½JSä»£ç 
3.[RCTBatchedBridge executeSourceCode:sourceCode] -> è®©æ‰¹é‡äº¤æ¥å¯¹è±¡æ‰§è¡Œæºä»£ç 


[RCTJSCExecutor executeApplicationScript] -> äº¤ç»™JSæ‰§è¡Œè€…ï¼ˆRCTJSCExecutorï¼‰æ‰§è¡Œæºç )


çœŸæ­£æ‰§è¡ŒJSä»£ç çš„æ˜¯RCTJSCExecutorå¯¹è±¡


5.[postNotificationName:RCTJavaScriptDidLoadNotification] -> å‘é€JSä»£ç æ‰§è¡Œå®Œæˆé€šçŸ¥
6.RCTRootViewç›‘å¬åˆ°RCTJavaScriptDidLoadNotificationé€šçŸ¥
7.åˆ›å»ºRCTRootContentView
8.è·å–RCTBridgeä¸­çš„RCTUIManageræ³¨å†ŒRCTRootView,å¹¶ä¸”è®°å½•RCTRootViewï¼Œ_viewRegistry


`RCTUIManager:ç®¡ç†UIç»„ä»¶
_viewRegistryï¼šä¿å­˜æ‰€æœ‰æ³¨å†Œçš„View`


9.[RCTRootView runApplication:bridge] -> é€šçŸ¥JSè¿è¡ŒApp
10.[RCTBridge enqueueJSCall:@"AppRegistry"
method:@"runApplication"
args:@[moduleName, appParameters]
completion:NULL] -> é€šè¿‡æ¡¥æ¥å¯¹è±¡è®©JSè°ƒç”¨AppRegistry
11.[RCTBatchedBridge _actuallyInvokeAndProcessModule:module method:method arguments:args queue:RCTJSThread] -> é€šè¿‡æ‰¹é‡æ¡¥æ¶è®©JSæ‰§è¡ŒAppRegistryæ–¹æ³•
12.[RCTJSCExecutor _executeJSCall:bridgeMethod arguments:@[module, method, args] unwrapResult:unwrapResult callback:onComplete] -> è®©JSæ‰§è¡Œè€…è°ƒç”¨JSä»£ç 
13.æ‰§è¡Œå®ŒJSä»£ç ï¼Œå°±èƒ½è·å–æ‰§è¡ŒJSç»“æœï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒOCéœ€è¦åšçš„äº‹æƒ…éƒ½ä¼šä¿å­˜åˆ°è¿™ä¸ªæ•°ç»„ä¸­
14.[RCTBatchedBridge _processResponse:json error:error] -> å¤„ç†æ‰§è¡Œå®ŒJSä»£ç è¿”å›çš„ç»“æœå¯¹è±¡
15.[RCTBatchedBridge handleBuffer] -> å¤„ç†JSè¿”å›çš„æ•°æ®ï¼ŒJSä¼šè¿”å›çš„æ–¹æ³•è°ƒç”¨æ•°ç»„ï¼šæŒ‰é¡ºåºæè¿°éœ€è¦è°ƒç”¨å“ªä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼Œä¸€ç»„è°ƒç”¨åŒ…å«ï¼ˆmoduleï¼Œmethodï¼Œargumentsï¼‰
16.[self callNativeModule:[moduleIDs[index] integerValue]
method:[methodIDs[index] integerValue]
params:paramsArrays[index]] -> éå†æ•°ç»„ï¼Œä¾æ¬¡æ‰§è¡ŒåŸç”Ÿæ–¹æ³•
`æ³¨æ„ï¼šå½“å‰æ–¹æ³•ï¼Œåœ¨éå†æ•°ç»„ä¸­çš„ä»£ç å—ä¸­æ‰§è¡Œï¼Œä¸åªæ˜¯æ‰§è¡Œä¸€æ¬¡.`

![](/media/15635256320339/15637641979937.jpg)
### 1.5 React NativeUIæ§ä»¶æ¸²æŸ“æµç¨‹(iOS)
1.[RCTRootView runApplication:bridge] -> é€šçŸ¥JSè¿è¡ŒApp
2.[RCTBatchedBridge _processResponse:json error:error] -> å¤„ç†æ‰§è¡Œå®ŒJSä»£ç (runApplication)è¿”å›çš„ç›¸åº”ï¼ŒåŒ…å«éœ€è¦æ·»åŠ å¤šå°‘å­æ§ä»¶çš„ä¿¡æ¯ã€‚
3.[RCTBatchedBridge batchDidComplete] -> æ‰¹é‡æ¡¥æ¶å¯¹è±¡è°ƒç”¨æ‰¹é‡å¤„ç†å®Œæˆæ–¹æ³•
4.[RCTUIManager batchDidComplete] ->  RCTUIManagerè°ƒç”¨æ‰¹é‡å¤„ç†å®Œæˆçš„æ–¹æ³•ï¼Œå°±ä¼šå¼€å§‹å»åŠ è½½rootViewçš„å­æ§ä»¶ã€‚

5.[RCTUIManager createView:viewName:rootTag:props] -> é€šè¿‡JSæ‰§è¡ŒOCä»£ç ï¼Œè®©UIç®¡ç†è€…åˆ›å»ºå­æ§ä»¶View

6.[RCTUIManager _layoutAndMount] -> å¸ƒå±€RCTRootViewå’Œå¢åŠ å­æ§ä»¶

7.[RCTUIManager setChildren:reactTags:] -> ç»™RCTRootViewå¯¹åº”çš„RCTRootShadowViewè®¾ç½®å­æ§ä»¶

æ³¨æ„ï¼šæ­¤æ–¹æ³•ä¹Ÿæ˜¯JSè°ƒç”¨OCæ–¹æ³•


8.[RCTRootShadowView insertReactSubview:view atIndex:index++] -> éå†å­æ§ä»¶æ•°ç»„ï¼Œç»™RCTRootShadowViewæ’å…¥æ‰€æœ‰å­æ§ä»¶
9.[RCTShadowView processUpdatedProperties:parentProperties:] -> å¤„ç†ä¿å­˜åœ¨RCTShadowViewä¸­å±æ€§ï¼Œå°±ä¼šå»å¸ƒå±€RCTShadowViewå¯¹åº”UIViewçš„æ‰€æœ‰å­æ§ä»¶
10.[RCTView didUpdateReactSubviews] -> ç»™åŸç”ŸViewæ·»åŠ å­æ§ä»¶
11.å®ŒæˆUIæ¸²æŸ“
### 1.6 React Nativeäº‹ä»¶å¤„ç†æµç¨‹(iOS)
1.åœ¨åˆ›å»ºRCTRootContentViewçš„æ—¶å€™ï¼Œå†…éƒ¨ä¼šåˆ›å»ºRCTTouchHandler
RCTTouchHandler:ç»§æ‰¿UIGestureRecognizerï¼Œä¹Ÿå°±æ˜¯å®ƒå°±æ˜¯ä¸€ä¸ªæ‰‹åŠ¿
å¹¶ä¸”å®ƒä¼šä½œä¸ºRCTRootContentViewçš„æ‰‹åŠ¿ï¼Œè¿™æ ·ç‚¹å‡»RCTRootContentViewï¼Œå°±ä¼šè§¦å‘RCTTouchHandler
RCTTouchHandler:å†…éƒ¨å®ç°äº†touchBeginç­‰è§¦æ‘¸æ–¹æ³•ï¼Œç”¨æ¥å¤„ç†è§¦æ‘¸äº‹ä»¶
2.åœ¨åˆ›å»ºRCTTouchHandlerçš„æ—¶å€™ï¼Œå†…éƒ¨ä¼šåˆ›å»ºRCTEventDispatcher
RCTEventDispatcher:ç”¨æ¥æŠŠäº‹ä»¶å¤„ç†ä¼ é€’ç»™JSçš„æ–¹æ³•å¤„ç†ï¼Œä¹Ÿå°±æ˜¯å½“UIç•Œé¢äº§ç”Ÿäº‹ä»¶ï¼Œå°±ä¼šæ‰§è¡ŒJSçš„ä»£ç å¤„ç†ã€‚
3.é€šè¿‡RCTRootContentViewæˆªè·ç‚¹å‡»äº‹ä»¶
äº§ç”Ÿäº‹ä»¶å°±ä¼šå»è§¦çŠ¯RCTRootContentViewä¸­çš„RCTTouchHandlerå¯¹è±¡ã€‚
4.å½“äº§ç”Ÿäº‹ä»¶çš„æ—¶å€™,ä¼šæ‰§è¡Œ[RCTTouchHandler touchBegin]
5.RCTTouchHandlerçš„touchæ–¹æ³•ï¼Œä¼šæ‰§è¡Œ[RCTTouchHandler _updateAndDispatchTouches:eventName:]
å†…éƒ¨ä¼šåˆ›å»ºRCTTouchEventäº‹ä»¶å¯¹è±¡
6.[RCTEventDispatcher sendEvent:event] -> è®©äº‹ä»¶åˆ†å‘å¯¹è±¡è°ƒç”¨å‘é€äº‹ä»¶å¯¹è±¡
å†…éƒ¨ä¼šæŠŠäº‹ä»¶ä¿å­˜åˆ°_eventQueueï¼ˆäº‹ä»¶é˜Ÿåˆ—ä¸­ï¼‰
7.[RCTEventDispatcher flushEventsQueue] -> è®©äº‹ä»¶åˆ†å‘å¯¹è±¡å†²åˆ·äº‹ä»¶é˜Ÿåˆ—ï¼Œå°±æ˜¯è·å–äº‹ä»¶é˜Ÿåˆ—ä¸­æ‰€æœ‰äº‹ä»¶æ‰§è¡Œ
8.[RCTEventDispatcher dispatchEvent:event] -> éå†äº‹ä»¶é˜Ÿåˆ—ï¼Œä¸€ä¸ªä¸€ä¸ªåˆ†å‘äº‹ä»¶
åˆ†å‘äº‹ä»¶çš„æœ¬è´¨ï¼šå°±æ˜¯å»æ‰§è¡ŒJSçš„ä»£ç ï¼Œç›¸åº”äº‹ä»¶ã€‚
9.[RCTBatchedBridge enqueueJSCall:[[event class] moduleDotMethod] args:[event arguments]]; -> è®©æ¡¥æ¶å¯¹è±¡è°ƒç”¨JSå¤„ç†äº‹ä»¶
æœ¬è´¨ï¼šå°±æ˜¯äº§ç”Ÿäº‹ä»¶è°ƒç”¨JSä»£ç 
10.è¿™æ ·å°±èƒ½å®ŒæˆæŠŠUIäº‹ä»¶äº¤ç»™JSä»£ç ç›¸åº”

![](/media/15635256320339/15637646140929.jpg)


####  React Nativeä¼˜ç‚¹ç¼ºç‚¹åˆ†äº«
**1.ä¼˜ç‚¹**
å¤ç”¨äº† React çš„æ€æƒ³ï¼Œæœ‰åˆ©äºå‰ç«¯å¼€å‘è€…æ¶‰è¶³ç§»åŠ¨ç«¯ã€‚
èƒ½å¤Ÿåˆ©ç”¨ JavaScript åŠ¨æ€æ›´æ–°çš„ç‰¹æ€§ï¼Œå¿«é€Ÿè¿­ä»£ã€‚
ç›¸æ¯”äºåŸç”Ÿå¹³å°ï¼Œå¼€å‘é€Ÿåº¦æ›´å¿«ï¼Œç›¸æ¯”äº Hybrid æ¡†æ¶ï¼Œæ€§èƒ½æ›´å¥½ã€‚
**2.ç¼ºç‚¹**
åšä¸åˆ°Write once, Run everywhereï¼Œä¹Ÿå°±æ˜¯è¯´å¼€å‘è€…ä¾ç„¶éœ€è¦ä¸º iOS å’Œ Android å¹³å°æä¾›ä¸¤å¥—ä¸åŒçš„ä»£ç ï¼Œæ¯”å¦‚å‚è€ƒå®˜æ–¹æ–‡æ¡£å¯ä»¥å‘ç°ä¸å°‘ç»„ä»¶å’ŒAPIéƒ½åŒºåˆ†äº† Android å’Œ iOS ç‰ˆæœ¬ã€‚å³ä½¿æ˜¯å…±ç”¨ç»„ä»¶ï¼Œä¹Ÿä¼šæœ‰å¹³å°ç‹¬äº«çš„å‡½æ•°ã€‚ä¸èƒ½åšåˆ°å®Œå…¨å±è”½ iOS ç«¯æˆ– Android çš„ç»†èŠ‚ï¼Œå‰ç«¯å¼€å‘è€…å¿…é¡»å¯¹åŸç”Ÿå¹³å°æœ‰æ‰€äº†è§£ã€‚åŠ é‡äº†å­¦ä¹ æˆæœ¬ã€‚å¯¹äºç§»åŠ¨ç«¯å¼€å‘è€…æ¥è¯´ï¼Œå®Œå…¨ä¸å…·å¤‡ç”¨ React Native å¼€å‘çš„èƒ½åŠ›ã€‚ç”±äº Objective-C ä¸ JavaScript ä¹‹é—´åˆ‡æ¢å­˜åœ¨å›ºå®šçš„æ—¶é—´å¼€é”€ï¼Œæ‰€ä»¥æ€§èƒ½å¿…å®šä¸åŠåŸç”Ÿã€‚æ¯”å¦‚ç›®å‰çš„å®˜æ–¹ç‰ˆæœ¬æ— æ³•åšåˆ° UItableview(ListView) çš„è§†å›¾é‡ç”¨ï¼Œå› ä¸ºæ»‘åŠ¨è¿‡ç¨‹ä¸­ï¼Œè§†å›¾é‡ç”¨éœ€è¦åœ¨å¼‚æ­¥çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œé€Ÿåº¦å¤ªæ…¢ã€‚è¿™ä¹Ÿå°±å¯¼è‡´éšç€ Cell æ•°é‡çš„å¢åŠ ï¼Œå ç”¨çš„å†…å­˜ä¹Ÿçº¿æ€§å¢åŠ 
**3æ€»ç»“**
RNçš„æ•´ä½“æ€æƒ³æ˜¯ä¸€å¤„å­¦ä¹ åˆ°å¤„ä½¿ç”¨ï¼Œæ‰€ä»¥åœ¨Androidå’ŒIosçš„ä½¿ç”¨æ–¹å¼ä¸Šè¿˜æ˜¯æœ‰å·®å¼‚çš„ï¼Œè€Œä¸”åœ¨å¼€å‘æ’ä»¶çš„æ—¶å€™ï¼Œè¿˜æ˜¯éœ€è¦å¼€å‘android iosä¸¤å¥—æ’ä»¶ï¼Œèƒ½è¾¾åˆ°åƒH5ä¸€æ ·ï¼Œä¸€å¤„ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œè¿˜æ˜¯æœ‰å¾ˆå¤§çš„å·®å¼‚çš„ï¼Œæ‰€ä»¥é™¤äº†androidå’Œioså›¢é˜Ÿå¤–è¿˜éœ€è¦ä¸€ä¸ªå›¢é˜Ÿç»´æŠ¤RNï¼ŒRNæ¶æ„çš„ç»´æŠ¤æˆæœ¬è¦æ¯”androidå’Œiosçš„å¼€å‘çš„éš¾åº¦é«˜å¤šäº†ã€‚æ‰€ä»¥æˆæœ¬æ¯”åŸæ¥è¿˜é«˜ï¼Œè¿˜æœ‰å¾ˆå¤šRnæ¶æ„æœ¬èº«æ²¡æœ‰åŠæ³•ç»“å±€çš„é—®é¢˜ï¼Œå¯¹äºå°å›¢é˜Ÿæ¥è¯´ç®€ç›´å°±æ˜¯å™©æ¢¦ã€‚
## 2ã€Flutter
### 2.1 Flutter æ•´ä½“æ¶æ„

å®ƒå¯ä»¥ç†è§£åœ¨RNä¸Šå¢åŠ äº†ä¸€ä¸ªdartè™šæ‹Ÿæœºï¼Œæ‰€ä»¥å‡å°‘äº†æ¡¥çš„äº¤äº’ï¼Œæ‰€ä»¥æ€§èƒ½æ–¹é¢ä¼šæ›´åŠ ä¼˜ç§€ï¼Œè¿˜æœ‰ä¸€ç‚¹å°±æ˜¯ç»´æŠ¤ä¸Šï¼Œflutteræœ‰Googleç»´æŠ¤ï¼Œæ‰€ä»¥ä»–çš„æ’ä»¶å¼€å‘å°†ä¼šæ›´åŠ è§„èŒƒï¼Œæ‰€ä»¥ç†è®ºä¸Šå¾ˆå®¹æ˜“å®ç°è·¨å¹³å°ä»£ç å¤ç”¨çš„æƒ…å†µ
Flutter ä¸»è¦åˆ†ä¸º Framework  å’Œ Engineï¼Œæˆ‘ä»¬åŸºäºFramework å¼€å‘Appï¼Œè¿è¡Œåœ¨ Engine ä¸Šã€‚Engine æ˜¯ Flutter çš„ç‹¬ç«‹è™šæ‹Ÿæœºï¼Œç”±å®ƒé€‚é…å’Œæä¾›è·¨å¹³å°æ”¯æŒ.

å¦‚ä¸‹å›¾ï¼Œå¾—ç›Šäº Engine å±‚ï¼ŒFlutter ç”šè‡³ä¸ä½¿ç”¨ç§»åŠ¨å¹³å°çš„åŸç”Ÿæ§ä»¶ï¼Œ è€Œæ˜¯ä½¿ç”¨è‡ªå·±  Engine æ¥ç»˜åˆ¶ Widget ï¼ˆFlutterçš„æ˜¾ç¤ºå•å…ƒï¼‰ï¼Œè€Œ Dart ä»£ç éƒ½æ˜¯é€šè¿‡ AOT ç¼–è¯‘ä¸ºå¹³å°çš„åŸç”Ÿä»£ç ï¼Œæ‰€ä»¥ Flutter å¯ä»¥ ç›´æ¥ä¸å¹³å°é€šä¿¡ï¼Œä¸éœ€è¦JSå¼•æ“çš„æ¡¥æ¥ã€‚åŒæ—¶ Flutter å”¯ä¸€è¦æ±‚ç³»ç»Ÿæä¾›çš„æ˜¯ canvasï¼Œä»¥å®ç°UIçš„ç»˜åˆ¶ã€‚
è¿™å¼ å›¾äº†è§£è¿‡ Flutterçš„äººå¯èƒ½å¾ˆå¤šåœ°æ–¹éƒ½çœ‹è¿‡ï¼Œè¿™è¾¹æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼š
![](/media/15635256320339/15637662920266.jpg)


```
> Framework
Meterial, Cupertinoï¼šé’ˆå¯¹ Android çš„ Meterial é£æ ¼ï¼Œå’Œé’ˆå¯¹ iOS çš„ Cupertino é£æ ¼ï¼›
Widgetsï¼šæŒ‰é’®ã€æ–‡æœ¬ã€è¾“å…¥æ¡†ã€å›¾ç‰‡ç­‰ç»„ä»¶ï¼›
Renderingï¼šæ¸²æŸ“å±‚ï¼Œè´Ÿè´£å¸ƒå±€ã€ç»˜åˆ¶ã€åˆæˆç­‰ï¼›
Animation, Painting, Gesturesï¼šåŠ¨ç”»ã€ç»˜å›¾ã€æ‰‹åŠ¿ï¼›
Foundationï¼šæœ€åº•å±‚ï¼Œæä¾›ä¸Šå±‚éœ€è¦ä½¿ç”¨çš„å·¥å…·ç±»å’Œæ–¹æ³•ï¼›
> Engine
Skiaï¼šå›¾å½¢ç»˜åˆ¶
Dartï¼šè¯­è¨€è¿è¡Œæ—¶
Textï¼šçº¹ç†
```

Flutter Framework: è¿™æ˜¯ä¸€ä¸ªçº¯ Dartå®ç°çš„ SDKï¼Œç±»ä¼¼äº Reactåœ¨ JavaScriptä¸­çš„ä½œç”¨ã€‚å®ƒå®ç°äº†ä¸€å¥—åŸºç¡€åº“ï¼Œ ç”¨äºå¤„ç†åŠ¨ç”»ã€ç»˜å›¾å’Œæ‰‹åŠ¿ã€‚å¹¶ä¸”åŸºäºç»˜å›¾å°è£…äº†ä¸€å¥— UIç»„ä»¶åº“ï¼Œç„¶åæ ¹æ® Material å’ŒCupertinoä¸¤ç§è§†è§‰é£æ ¼åŒºåˆ†å¼€æ¥ã€‚è¿™ä¸ªçº¯ Dartå®ç°çš„ SDKè¢«å°è£…ä¸ºäº†ä¸€ä¸ªå«ä½œ dart:uiçš„ Dartåº“ã€‚æˆ‘ä»¬åœ¨ä½¿ç”¨ Flutterå†™ Appçš„æ—¶å€™ï¼Œç›´æ¥å¯¼å…¥è¿™ä¸ªåº“å³å¯ä½¿ç”¨ç»„ä»¶ç­‰åŠŸèƒ½ã€‚

Flutter Engine: è¿™æ˜¯ä¸€ä¸ªçº¯ C++å®ç°çš„ SDKï¼Œå…¶ä¸­å›Šæ‹¬äº† Skiaå¼•æ“ã€Dartè¿è¡Œæ—¶ã€æ–‡å­—æ’ç‰ˆå¼•æ“ç­‰ã€‚ä¸è¿‡è¯´ç™½äº†ï¼Œå®ƒå°±æ˜¯ Dartçš„ä¸€ä¸ªè¿è¡Œæ—¶ï¼Œå®ƒå¯ä»¥ä»¥ JITã€JIT Snapshot æˆ–è€… AOTçš„æ¨¡å¼è¿è¡Œ Dartä»£ç ã€‚åœ¨ä»£ç è°ƒç”¨ dart:uiåº“æ—¶ï¼Œæä¾› dart:uiåº“ä¸­ Native Binding å®ç°ã€‚ ä¸è¿‡åˆ«å¿˜äº†ï¼Œè¿™ä¸ªè¿è¡Œæ—¶è¿˜æ§åˆ¶ç€ VSyncä¿¡å·çš„ä¼ é€’ã€GPUæ•°æ®çš„å¡«å……ç­‰ï¼Œå¹¶ä¸”è¿˜è´Ÿè´£æŠŠå®¢æˆ·ç«¯çš„äº‹ä»¶ä¼ é€’åˆ°è¿è¡Œæ—¶ä¸­çš„ä»£ç ã€‚ 


### 2.2 Flutter ç»˜å›¾åŸºæœ¬åŸç†

1. CPU å°†è®¡ç®—å¥½çš„æ˜¾ç¤ºå†…å®¹æäº¤ç»™ GPU
2. GPU ä½¿ç”¨ VRAM(å­˜å–å­˜å‚¨å™¨) ä¸­çš„æ•°æ®å’Œå‘½ä»¤ï¼Œå®Œæˆå›¾åƒæ¸²æŸ“
3. å°†æ¸²æŸ“å¥½çš„ç»“æœå­˜å…¥å¸§ç¼“å†²åŒº (FrameBuffer)
4. ç„¶åè§†é¢‘æ§åˆ¶å™¨å°†å¸§ç¼“å†²åŒºçš„æ•°æ®ä¼ é€’ç»™æ˜¾ç¤ºå™¨æ˜¾ç¤º
![](/media/15635256320339/15638686209274.jpg)

Androidã€iOSçš„ Appåœ¨æ˜¾ç¤º UIæ—¶æ˜¯å¦‚æ­¤ï¼ŒFlutterä¹Ÿä¸ä¾‹å¤–ï¼Œä¹Ÿéµå¾ªäº†è¿™ç§æ¨¡å¼ã€‚æ‰€ä»¥ä»è¿™é‡Œå¯ä»¥çœ‹å‡º Flutterå’Œ React-Nativeä¹‹ä¼—çš„æœ¬è´¨åŒºåˆ«ï¼šReact-Nativeä¹‹ç±»åªæ˜¯æ‰©å±•è°ƒç”¨ OEMç»„ä»¶ï¼Œè€Œ Flutteræ˜¯è‡ªå·±æ¸²æŸ“ã€‚

Googleè¿˜æä¾›äº†ä¸€å¼ æ›´ä¸ºè¯¦å°½çš„å›¾æ¥è§£é‡Š Flutterçš„åŸç†ï¼š
![](/media/15635256320339/15638689350484.jpg)

* GPUå°†ä¿¡å·åŒæ­¥åˆ° UI çº¿ç¨‹
* UI çº¿ç¨‹ç”¨Dartæ¥æ„å»ºå›¾å±‚æ ‘
* å›¾å±‚æ ‘åœ¨GPU çº¿ç¨‹è¿›è¡Œåˆæˆ
* åˆæˆåçš„è§†å›¾æ•°æ®æä¾›ç»™Skia å¼•æ“
* Skia å¼•æ“é€šè¿‡OpenGL æˆ–è€… Vulkanå°†æ˜¾ç¤ºå†…å®¹æä¾›ç»™GPU

è¿™å¼ å›¾è§£é‡Šå¾—æ›´æ¸…æ™°ä¸€äº›ï¼šFlutteråªå…³å¿ƒå‘ GPUæä¾›è§†å›¾æ•°æ®ï¼ŒGPUçš„ VSyncä¿¡å·åŒæ­¥åˆ° UIçº¿ç¨‹ï¼ŒUIçº¿ç¨‹ä½¿ç”¨ Dartæ¥æ„å»ºæŠ½è±¡çš„è§†å›¾ç»“æ„ï¼Œè¿™ä»½æ•°æ®ç»“æ„åœ¨ GPUçº¿ç¨‹è¿›è¡Œå›¾å±‚åˆæˆï¼Œè§†å›¾æ•°æ®æä¾›ç»™ Skiaå¼•æ“æ¸²æŸ“ä¸º GPUæ•°æ®ï¼Œè¿™äº›æ•°æ®é€šè¿‡ OpenGL(å›¾å½¢åº“)æˆ–è€… Vulkan(äºŒç»´ ä¸‰ç»´ api)æä¾›ç»™ GPUã€‚

æ‰€ä»¥ Flutterå¹¶ä¸å…³å¿ƒæ˜¾ç¤ºå™¨ã€è§†é¢‘æ§åˆ¶å™¨ä»¥åŠ GPUå…·ä½“å·¥ä½œï¼Œå®ƒåªå…³å¿ƒ GPUå‘å‡ºçš„ VSyncä¿¡å·ï¼Œå°½å¯èƒ½å¿«åœ°åœ¨ä¸¤ä¸ª VSyncä¿¡å·ä¹‹é—´è®¡ç®—å¹¶åˆæˆè§†å›¾æ•°æ®ï¼Œå¹¶ä¸”æŠŠæ•°æ®æä¾›ç»™ GPUã€‚

**è¡¥å……:Skiaæ˜¯ä»€ä¹ˆï¼Ÿ**
å‰é¢æåˆ°äº† Flutteråªå…³å¿ƒå¦‚ä½•æ„å»ºè§†å›¾æŠ½è±¡ç»“æ„ï¼Œå‘ GPUæä¾›è§†å›¾æ•°æ®ã€‚Skiaå°±æ˜¯ Flutterå‘ GPUæä¾›æ•°æ®çš„é€”å¾„ã€‚

Skiaæ˜¯ä¸€ä¸ª 2Dçš„ç»˜å›¾å¼•æ“åº“ï¼Œå…¶å‰èº«æ˜¯ä¸€ä¸ªå‘é‡ç»˜å›¾è½¯ä»¶ï¼ŒChromeå’Œ Androidå‡é‡‡ç”¨ Skiaä½œä¸ºç»˜å›¾å¼•æ“ã€‚Skiaæä¾›äº†éå¸¸å‹å¥½çš„ APIï¼Œå¹¶ä¸”åœ¨å›¾å½¢è½¬æ¢ã€æ–‡å­—æ¸²æŸ“ã€ä½å›¾æ¸²æŸ“æ–¹é¢éƒ½æä¾›äº†å‹å¥½ã€é«˜æ•ˆçš„è¡¨ç°ã€‚Skiaæ˜¯è·¨å¹³å°çš„ï¼Œæ‰€ä»¥å¯ä»¥è¢«åµŒå…¥åˆ° Flutterçš„ iOS SDKä¸­ï¼Œè€Œä¸ç”¨å»ç ”ç©¶ iOSé—­æºçš„ Core Graphics / Core Animationã€‚

**åœ¨äº†è§£å±å¹•ç»˜å›¾çš„åŸºæœ¬åŸç†å’Œ Flutterçš„ä¸€ä¸ªæ•´ä½“æ¦‚å¿µåï¼Œæˆ‘ä»¬ä¸‹é¢è¯¦ç»†åœ°æ¥çœ‹ä¸€ä¸‹ Flutterçš„å¤§æ¦‚å®ç°ã€‚**
### 2.3 Flutteråº”ç”¨çš„è¿è¡Œ
è¦ç†è§£ Flutterçš„åŸç†ï¼Œæˆ‘ä»¬ä» entry pointå¼€å§‹çœ‹ Flutterçš„ä»£ç ã€‚ç”±äºåº”ç”¨æ¡†æ¶å¤§åŒå°å¼‚ï¼Œæ‰€ä»¥ä¸‹æ–‡æåŠ Flutterçš„ä»£ç å³æŒ‡ä»£ Flutter Engineçš„ä»£ç ï¼Œè€Œé Flutter Dart Frameworkä»£ç ã€‚

ä¸‹å›¾æ˜¯æˆ‘ç®€å•æ•´ç†äº†ä¸€ä¸‹ Flutteråº”ç”¨å¯åŠ¨åçš„æ‰§è¡Œé¡ºåº

![](/media/15635256320339/15638697810641.jpg)

åœ¨åº”ç”¨çš„ View Controller åˆå§‹åŒ–åï¼Œä¼šå®ä¾‹åŒ–ä¸€ä¸ª Flutter projectçš„æŠ½è±¡ï¼ˆä»¥ä¸‹ç®€ç§° projectï¼‰ã€‚projectä¼šåˆå§‹åŒ–ä¸€ä¸ª platform viewçš„æŠ½è±¡å®ä¾‹ï¼Œè¿™ä¸ªæŠ½è±¡å®ä¾‹ä¼šè´Ÿè´£åˆ›å»º Flutter çš„è¿è¡Œæ—¶ï¼ˆä»¥ä¸‹ç®€ç§° engineï¼‰ã€‚

å½“ View Controllerå°†è¦æ˜¾ç¤ºæ—¶ï¼Œè°ƒç”¨ projectæŸ¥æ‰¾å’Œç»„åˆ Flutterçš„åº”ç”¨èµ„æº bundleï¼Œå¹¶ä¸”æŠŠèµ„æºæä¾›ç»™ engineã€‚ 
engineåœ¨çœŸæ­£éœ€è¦æ‰§è¡Œèµ„æº bundleæ—¶æ‰ä¼šåˆ›å»º Dartæ‰§è¡Œçš„ç¯å¢ƒï¼ˆæ‡’åŠ è½½ï¼Œä»¥ä¸‹ç®€ç§° Dart Controllerï¼‰ï¼Œç„¶åè®¾ç½®è§†å›¾çª—å£çš„ä¸€äº›å±æ€§ç­‰ä¸œè¥¿ï¼ˆè¿™æ˜¯ç»˜å›¾å¼•æ“å¿…éœ€çš„ï¼‰ã€‚ 
ç„¶å engineä¸­çš„ Dart Controllerä¼šåŠ è½½ Dartä»£ç å¹¶æ‰§è¡Œï¼Œæ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¼šè°ƒç”¨ dart:uiçš„ native bindingå®ç°å‘ GPUæä¾›æ•°æ®ã€‚

**VSyncä¿¡å·çš„åŒæ­¥**
è¦è®©è§†å›¾åŠ¨æ€åŒ–ï¼Œä»…ä»…èƒ½å®ç°è§†å›¾ç»˜åˆ¶è¿˜ä¸è¡Œï¼Œè¿˜å¾—çŸ¥é“ç¡¬ä»¶ä½•æ—¶å‘é€äº† VSyncä¿¡å·ï¼Œé€šè¿‡è·å– VSyncä¿¡å·ï¼Œè®¡ç®—å¹¶ç»™ GPUæä¾›æ•°æ®æ¥æ„å»ºåŠ¨æ€åŒ–çš„ç•Œé¢ã€‚ä¸è¿‡æ¯ä¸ªå¹³å°çš„ VSyncä¿¡å·çš„è·å–æ–¹å¼ä¸å¤ªä¸€æ ·ï¼Œæˆ‘ä»¬è¿™é‡Œè®¨è®ºä¸€ä¸‹ iOSä¸Šçš„å®ç°ï¼Œä»¥æ­¤ç®¡ä¸­çª¥è±¹ã€‚
åœ¨ flutter/shell/platform/darwin/ios/framework/source/FlutterView.mmå®ç°é‡Œé¢å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ UIViewçš„ CALayer delegateä¸­è°ƒç”¨äº† SnapshotContentsSyncå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šå›è°ƒåˆ° GPUçº¿ç¨‹ï¼Œä» GPUçº¿ç¨‹æ‰§è¡Œè·å– LayerTreeï¼Œè®¡ç®—å¹¶åˆæˆä½å›¾ï¼Œç„¶åæŠŠä½å›¾ä¿¡æ¯ä¼ é€’ç»™ Skiaå¼•æ“ï¼ŒSkiaå¼•æ“é€šè¿‡ CGContextRefæŠŠä½å›¾ä¿¡æ¯ä¼ é€’ç»™ GPUã€‚

    - (void)drawLayer:(CALayer*)layer inContext:(CGContextRef)context {
      SnapshotContentsSync(context, self);
    }
    // å›è°ƒåˆ° GPUçº¿ç¨‹è®¡ç®—ï¼Œå¹¶ä¸”è¿™é‡Œç”¨äº†ä¸€ä¸ª Dart futureçš„ nativeç‰ˆæ¥åŒæ­¥ç­‰å¾… GPUçº¿ç¨‹æ‰§è¡Œç»“æœ
    void SnapshotContentsSync(CGContextRef context, UIView* view) {
      auto gpu_thread = blink::Threads::Gpu();
    
      if (!gpu_thread) {
        return;
      }
    
      fxl::AutoResetWaitableEvent latch;
      gpu_thread->PostTask([&latch, context, view]() {
        SnapshotContents(context, [view isOpaque]);
        latch.Signal();
      });
      latch.Wait();
    }
    
    // SnapshotContentsSync å†…å®¹å¤ªé•¿ä¸èµ˜è¿°ï¼Œç²¾ç®€çœ‹ä¸€ä¸‹ï¼š
    {
      // è·å– LayerTree
      flow::LayerTree* layer_tree = rasterizer->GetLastLayerTree();
      if (layer_tree == nullptr) {
        return;
      }
      // è·å–å¯åˆæˆå›¾å±‚å¤§å°
      auto size = layer_tree->frame_size();
      if (size.isEmpty()) {
        return;
      }
      SkCanvas canvas(bitmap);
    
      {
        // åˆæˆå›¾å±‚
        flow::CompositorContext compositor_context(nullptr);
        auto frame = compositor_context.AcquireFrame(nullptr, &canvas, false /* instrumentation */);
        layer_tree->Raster(frame, false /* ignore raster cache. */);
      }
    
      canvas.flush();
    
      // Draw the bitmap to the system provided snapshotting context.
      // æŠŠä½å›¾ä½¿ç”¨ Skiaä¼ é€’ç»™ç³»ç»Ÿçš„ GPUç¼“å†²åŒº
      SkCGDrawBitmap(context, bitmap, 0, 0);
    }
ä¸è¿‡æœ‰ä¸€ç‚¹ä¸å¤ªç¡®å®šçš„æ˜¯ï¼ŒiOSçš„ Architectureä¸­ï¼Œå¹¶æ²¡æœ‰åœ°æ–¹æ˜ç¡®åœ°æåˆ° CALayerDelegateæ˜¯ä¸ VsyncåŒæ­¥çš„ã€‚ä¸è¿‡å¯ä»¥ç¡®å®šçš„æ˜¯ï¼ŒCALayerDelegateæ˜¯å¹¶å‘å¤šçº¿ç¨‹çš„ï¼Œè¿™ä¸ªåœ¨ CATiled Layeré‚£é‡Œå¯ä»¥å¾—åˆ°ä½“ç°ï¼Œè€Œ CALayer Delegateçš„æ•°æ®ç¡®å®æäº¤ç»™äº† GPUç¼“å†²åŒºå®ç°äº†å±å¹•å›¾åƒçš„æ˜¾ç¤ºã€‚


### 2.4 Flutter Engineçš„ç»„æˆ

å’±ä»¬åœ¨çœ‹ä¸‹è¿™ä¸ªå›¾
![](/media/15635256320339/15638511814157.jpg)


æˆ‘ä»¬æ‰¾åˆ°äº† VSyncæºï¼Œæ‰¾åˆ°äº† SkiaæŠŠæ•°æ®æäº¤ç»™ GPUçš„åœ°æ–¹ï¼Œè¿™ä¸¤å¤„å¯¹æˆ‘ä»¬æ¥è¯´éƒ½æ˜¯é»‘ç›’ï¼Œæ‰€ä»¥å°±å…ˆä¸ç®¡äº†ã€‚è€Œ UI Threadçš„ Dartï¼Œæš‚æ—¶ä¸åœ¨ç›®å‰çš„ engineè®¨è®ºèŒƒç•´å†…ã€‚æ‰€ä»¥æˆ‘ä»¬ç°åœ¨è¦åˆ†æçš„æ˜¯ç»™ UI å±‚æä¾›èƒ½åŠ›çš„æ‰€æœ‰ç»„ä»¶ã€‚

å¯ä»¥ç†è§£åœ¨æ•´ä¸ª Flutter Engineå¯ä»¥ç²—ç•¥åœ°åˆ’åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šDart UIã€Runtimeã€Shellï¼Œæˆ‘ä»¬ä¸€ä¸€é“æ¥ã€‚
#### **2.4.1 Dart UI**
Dart UIæ˜¯ä¸€ä¸ª C++å®ç°çš„ dart:uiåº“çš„ Native Bindingï¼Œå¹¶ä¸” UI Libä¹Ÿæ˜¯ Dart GUIç¨‹åºçš„åº”ç”¨ä¸»è¦å…¥å£ã€‚ 
Dart UIå‘ä¸Šå±‚æä¾›äº† windowã€textã€canvasã€geometryç­‰é€šç”¨çš„ç»˜å›¾èƒ½åŠ›ï¼Œ Runtimeåœ¨è°ƒç”¨ Dart UIæ—¶ï¼ŒDart UIæ ¹æ®ä¼ é€’çš„ main entrypoint æ¥æ‰§è¡Œå¹¶ä¸”å‘ windowæ¸²æŸ“å›¾åƒã€‚ 
å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒDart UIè¿˜å‘ä¸Šå±‚æä¾›äº† compsitingçš„ç»˜å›¾èƒ½åŠ›ï¼Œè¿™å…¶å®å°±æ˜¯ä¸€ä¸ª Skiaçš„ Sceneçš„å°è£…ï¼Œä¸Šå±‚åœ¨è°ƒç”¨ compsitingæ—¶å…¶å®å°±ä¼šç”Ÿæˆæˆ–æŒ‚è½½èŠ‚ç‚¹åˆ° LayerTreeä¸Šã€‚ç„¶åé€šè¿‡ LayerTreeçš„æ•°æ®ç»“æ„è¾…åŠ© Skiaè¿›è¡Œ Sceneåˆæˆä½å›¾ã€‚
`LayerTreeæ˜¯ flowåº“ä¸­çš„å›¾å±‚æŠ½è±¡ç±»ã€‚flow æ˜¯ chromeé¡¹ç›®ä¸­é€šç”¨çš„ç»˜å›¾æ•°æ®ç»“æ„æŠ½è±¡åº“ï¼Œå¯ä»¥é€‚é…åˆ°å…¶ä»–ç»˜å›¾å¼•æ“ä¸Šã€‚`
#### **2.4.2 Runtime**
Flutter Engineçš„ Runtimeå¯è°“æ¯”è¾ƒå¤æ‚ï¼Œå¹¶ä¸æ˜¯ä»£ç å¤šï¼Œè€Œæ˜¯ä½¿ç”¨äº†éå¸¸å¤šçš„ Delegateæ¨¡å¼ï¼Œå°†å¹³å°ç›¸å…³çš„ä»£ç äº¤ç”± Shelléƒ¨åˆ†å®ç°ã€‚

Runtimeè´Ÿè´£åˆ›å»º Dartçš„è¿è¡Œæ—¶ï¼Œå¹¶ä¸”åœ¨ä¸åŒçš„å¼€å‘é˜¶æ®µè¿è¡Œçš„ç¯å¢ƒä¹Ÿä¸ä¸€æ ·ã€‚å¼€å‘æ—¶æœŸæ˜¯ä¿ç•™ check modeçš„ Dart Snapshot VMï¼Œè€Œç”Ÿäº§ç¯å¢ƒæ˜¯ Dart AOT Runtimeã€‚
`Dart Snapshot VM å’Œ Dart JIT VMæœ‰ç€æœ¬è´¨çš„åŒºåˆ«ã€‚Dart Snapshotæ˜¯æŒ‡ tokenåŒ–çš„ Dartè„šæœ¬ï¼Œå¹¶é human readableçš„ã€‚è€Œ JIT VM æ˜¯ç›´æ¥ä»¥ scriptæ–¹å¼è¿è¡Œæºä»£ç ã€‚å¾ˆæ˜æ˜¾ Snapshot VMè¦æ¯” JIT VMç¨å¾®å¿«ä¸€äº›ã€‚`
![](/media/15635256320339/15638704392615.jpg)
ä¸Šå›¾ï¼Œçº¢æ¡†éƒ¨åˆ†æ˜¯åœ¨ Runtimeéƒ¨åˆ†æ‰§è¡Œçš„é€»è¾‘ã€‚engineçš„æŠ½è±¡å¤„äº Shellå±‚ï¼Œè€Œ ui_dart_stateå¤„äº Dart UI å±‚ã€‚
æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Runtimeä¼šç”± Shellå±‚è°ƒç”¨ç”Ÿæˆä¸€ä¸ª runtime controller å®ä¾‹ï¼Œè¿™ä¸ªå®ä¾‹ç®¡ç†ç€å½“å‰çš„ç»˜å›¾çª—å£windowçš„å±æ€§ï¼Œä¸€ä¸ª Dartçš„VM çš„å®ä¾‹ï¼Œä»¥åŠä¸€ä¸ª delegateï¼Œè¿™ä¸ª delegateèƒ½æ‰“é€š Shellå±‚å’Œ Dart UIå±‚çš„é€šä¿¡ï¼Œå¹¶ä¸”è´Ÿè´£äº‹ä»¶çš„ä¼ é€’ã€‚
#### **2.4.3. Shell**
è¿™é‡Œè¯´çš„ Shellå…¶å®å°±æ˜¯ â€œå£³â€ï¼Œè¿™ä¸ªå£³å°±æ˜¯ç»„åˆ Runtimeã€ç¬¬ä¸‰æ–¹å·¥å…·åº“ã€å¹³å°ç‰¹æ€§ç­‰ï¼Œå®ç°è°ƒç”¨å’Œæ‰§è¡Œ Flutteråº”ç”¨çš„é€»è¾‘ã€‚

1. Shell å°è£…äº†ä¸€ä¸ª engineçš„æŠ½è±¡ï¼Œè¿™ä¸ªæŠ½è±¡èƒ½å¤Ÿè°ƒç”¨ Runtimeï¼Œå®ç° Runtimeä¸­çš„ Delegateï¼Œä»¥æ­¤å‘ Runtimeæä¾›æ•°æ®å’Œå›è°ƒã€‚

2. Shell è¿˜å°è£…äº† platform viewçš„æŠ½è±¡ï¼Œå¹¶ä¸”å…·ä½“åœ°å®ç°äº† platform viewï¼Œåœ¨ iOSç‰¹å®šä»£ç ä¸­çš„è¡¨ç°å°±æ˜¯éµå¾ª Delegateæ–¹æ³•å¹¶æä¾›äº† UIViewå®ä¾‹çš„ç®¡ç†ã€‚

3. Shell æä¾›äº†ä¸€äº›åŸºç¡€å·¥å…·çš„å°è£…ï¼Œå¦‚ Futureï¼Œå¯ä»¥å®ç° dart:ioä¸­çš„ Futureç›¸åŒçš„æ‰§è¡Œé€»è¾‘ï¼Œå¹¶ä¸”è¿˜è´Ÿè´£äº†å¤„ç† VSyncä¿¡å·ï¼ŒUIã€GPU Threadçš„å›è°ƒã€‚

Shell æä¾›äº†ä» engineè·å– LayerTreeçš„å’Œè°ƒç”¨æ¸²æŸ“æ–¹æ³•çš„å°è£…
**æ€»çš„æ¥è¯´:**
Dart UIç»™ Dartæä¾›äº†è°ƒç”¨ Nativeç»˜å›¾çš„èƒ½åŠ›ï¼ŒRuntimeä¸º Flutteræä¾›äº†è°ƒç”¨ Dartå’Œ Dart UIçš„èƒ½åŠ›ï¼Œè€Œ Shellæ‰æ˜¯é›†å¤§æˆè€…ï¼ŒShellå°†ä»–ä»¬ç»„åˆèµ·æ¥ï¼Œå¹¶ä¸”ä»ä»–ä»¬ç”Ÿæˆçš„æ•°æ®ä¸­å®ç°æ¸²æŸ“ã€‚
![](/media/15635256320339/15638705734355.jpg)

2.3 Flutter å‡ ä¸ªé—®é¢˜ Again

1. Flutterèƒ½åŠ¨æ€æ›´æ–°å—ï¼Ÿ
åŸç‰ˆä¸è¡Œã€‚ç†è®ºå¯è¡Œã€‚åŠ¨æ€ä¸‹å‘æ„å‘³ç€ Dartæºä»£ç éœ€è¦ä»¥ JITæˆ– JIT Snapshotçš„æ–¹å¼è¿è¡Œï¼Œè€Œ Flutterçš„ production buildæ˜¯ AOTä»£ç ï¼Œæ‰€ä»¥åŸç‰ˆä¸è¡Œã€‚ä½† Flutterçš„ debug buildæ˜¯ JIT Snapshotè¿è¡Œï¼Œå¯ä»¥åŠ¨æ€æ›´æ–°ã€‚
é‚£ä¹ˆï¼Œæ—¢è¦ production buildï¼Œåˆè¦ JIT Snapshotæ‰§è¡Œï¼Œè¯¥å¦‚ä½•åšå‘¢ï¼Ÿ Flutter Engine SDKçš„ build optioné‡Œé¢å¯ä»¥è®¾ç½® mode = releaseï¼Œ AOT = falseï¼Œé‚£ä¹ˆ æ‰“å‡ºæ¥çš„ Engine SDKä¸ä¼šåŒ…å« Dart AOT Runtimeã€‚ å¹¶ä¸”éœ€è¦æ³¨æ„ Flutter CLI TOOLçš„ç¼–è¯‘æ–¹å¼ï¼Œéœ€è¦ä»¥ Snapshotæ–¹å¼ç¼–è¯‘æœ€ç»ˆçš„ productionä»£ç ã€‚
å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒJIT Snapshotæ–¹å¼æ‰§è¡Œæ€§èƒ½å¯èƒ½ç¨å·®ï¼Œ60fpså¯èƒ½ä¼šè¾¾ä¸åˆ°ã€‚

2. Flutter SDKä½“ç§¯ä¸ºä»€ä¹ˆéå¸¸å¤§ï¼Ÿ
Flutteråº”ç”¨çš„ä½“ç§¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šåº”ç”¨ä»£ç å’Œ SDKä»£ç ã€‚åº”ç”¨ä»£ç æ˜¯ Dartç¼–è¯‘åçš„ä»£ç ï¼Œå¦‚æœåšæˆå¯åŠ¨æ€ä¸‹å‘ï¼Œé‚£ä¹ˆè¿™éƒ¨åˆ†å¯ä»¥ä¸è®¡ã€‚
SDKä»£ç æ¯”è¾ƒå¤§å°±æœ‰ç‚¹æ— å¥ˆäº†ï¼ŒSDKçš„ç»„æˆéƒ¨åˆ†æœ‰ Dart VMï¼ŒDartæ ‡å‡†åº“ï¼Œlibwebpã€libpngã€libboringsslç­‰ç¬¬ä¸‰æ–¹åº“ï¼Œlibskiaï¼ŒDart UIåº“ï¼Œç„¶åå†åŠ ä¸Š icu_dataï¼Œå¯èƒ½åœ¨å• archä¸‹ï¼ˆiOSï¼‰ï¼ŒSDKä½“ç§¯è¾¾åˆ° 40+MBã€‚å…¶ä¸­ä»…ä»… Dart VMï¼ˆä¸åŒ…å«æ ‡å‡†åº“ï¼‰å°±è¾¾åˆ°äº† 7MBã€‚
Flutter SDKæ˜¯ dynamic frameworkï¼Œå¦‚æ­¤å¤§çš„äºŒè¿›åˆ¶ä½“ç§¯å¯èƒ½ä¼šé€ æˆåŠ¨æ€é“¾æ¥è€—æ—¶é•¿ã€‚è€Œå¦‚æœé™æ€é“¾æ¥ï¼Œå¯èƒ½åŸæ¥æ¯”è¾ƒå¤§çš„ Appå¾ˆæœ‰å¯èƒ½é€ æˆ TEXTæ®µè¶…æ ‡ã€‚

3. Flutterå¯ä»¥è·‘å¤šä¸ªå®ä¾‹å—ï¼Ÿ
ç†è®ºä¸Šæ˜¯å¯ä»¥çš„ã€‚è™½ç„¶ Flutter Engineçš„ Shellå±‚å†™æ­»äº†åªä¼šè·‘ä¸€ä¸ª Flutter Viewï¼ˆåªä¼šè·‘ä¸€ä¸ª Runtimeï¼‰ï¼Œä½†è¿™æ˜¯å¯ä»¥æ”¹å˜çš„ï¼Œè€Œä¸”åªéœ€è¦å°‘é‡çš„é€»è¾‘æ”¹åŠ¨ã€‚å”¯ä¸€éœ€è¦æ‹…å¿ƒçš„å°±æ˜¯å¤šä¸ªå®ä¾‹çš„å†…å­˜æ¶ˆè€—ã€‚

4. å»æ‰ Flutterçš„ç‰¹æ€§ï¼ŒåªåµŒå…¥ Dartåˆ°åº”ç”¨ä¸­ï¼Œå¯èƒ½å—ï¼Ÿ
å¯è¡Œã€‚Dartæ¯«æ— ç–‘é—®æ˜¯ä¸€é—¨ä¼˜ç§€çš„ç¼–ç¨‹è¯­è¨€ï¼Œæˆ‘ä¹Ÿæ›¾å°è¯•å°† Dartç‹¬ç«‹å‡ºæ¥ä½œä¸ºä¸€ä¸ªé€šç”¨çš„ SDKã€‚Dart SDKæ‰˜ç®¡åœ¨ chromiumé¡¹ç›®ä¸­ï¼Œå¹¶ä¸”æä¾›äº† cross buildingçš„é€‰é¡¹ã€‚åŸç‰ˆå³æä¾›äº† Android Buildè„šæœ¬ã€‚ä½†åœ¨ iOSä¸ŠåŸç‰ˆè¡Œä¸é€šï¼ŒçŒœæµ‹ä¸»è¦æ˜¯æ ‡å‡†åº“çš„é—®é¢˜ã€‚åœ¨ Flutter iOSé¡¹ç›®ä¸­ï¼ŒDart æ ‡å‡†åº“æä¾›äº†ä¸€ä»½å®Œå…¨ä¸åŒçš„å®ç°ã€‚è€Œä¸”ï¼Œæƒ³è¦æŠŠ Dart VMå’Œæ ‡å‡†åº“ä» Flutterå‰¥ç¦»å‡ºæ¥ï¼Œå¤ªå›°éš¾äº†ã€‚å¹¶ä¸”å•ä¸ª archä¸‹ï¼ŒDart VMåŠ æ ‡å‡†åº“çš„ä½“ç§¯æ˜¯ > 10MBçš„ã€‚
**2.4 Flutter vs WebView vs ReactNative**

WebView
æœ€æ—©çš„è·¨å¹³å°è§£å†³æ–¹æ¡ˆï¼Œæ˜¯å€ŸåŠ© App å†…éƒ¨çš„ WebView ç»„ä»¶æ¥å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯ App å†…éƒ¨çš„æµè§ˆå™¨ã€‚ä½†æ˜¯ç”±äºå®ƒçš„æ€§èƒ½ã€å…¼å®¹æ€§ã€ç¨³å®šæ€§éƒ½è¡¨ç°ä¸å¤Ÿå‡ºè‰²ï¼Œå¹¶ä¸”åœ¨è”è°ƒä¸Šæœ‰å¤ªå¤šçš„éšœç¢ï¼Œå¯¼è‡´è¿™ä¸ªæŠ€æœ¯å·²ç»ä¸å†æµè¡Œã€‚
![](/media/15635256320339/15638714427171.jpg)


è¯´ç™½äº†ï¼Œå…¶å®å®ƒä»…ä»…åªæ˜¯ Web çš„å¼€å‘ï¼ŒUI å’Œä¸šåŠ¡é€»è¾‘éƒ½æ˜¯ Web çš„éƒ¨åˆ†ï¼Œå¦‚æœè¦è°ƒå– Native çš„ç¡¬ä»¶è®¾å¤‡ï¼Œéœ€è¦ Native æ‹¦æˆªç‰¹æ®Šçš„ Http è¯·æ±‚ä»è€Œè·å–ç¡¬ä»¶è®¾å¤‡ä¿¡æ¯ã€‚å½“ç„¶å®ƒæœ‰è‡ªå·±çš„å¥½å¤„ï¼Œæ›´æ–°å¿«ï¼Œæœ‰é—®é¢˜éšæ—¶å‘å¸ƒã€‚
ReactNative
ReactNative åœ¨ WebView çš„æ–¹æ¡ˆä¸Šæ›´è¿›ä¸€æ­¥ï¼Œå€ŸåŠ© App å†…ç½® Javascrpit å¼•æ“ï¼Œå°† JavaScript å’Œ Native è¿›è¡Œæ¡¥æ¥ï¼Œç›´æ¥é€šè¿‡ JavaScript æ¥è°ƒå– Native çš„ç›¸å…³ç»„ä»¶ï¼Œåœ¨æ€§èƒ½ä¸Šæ¯” WebView è¦æ›´èƒœä¸€ç­¹ã€‚
![](/media/15635256320339/15638715210440.jpg)

è¿™ç§å½¢åŠ¿çš„è·¨å¹³å°å¹¶éçœŸæ­£æ„ä¹‰çš„è·¨å¹³å°ï¼Œå¦‚æœè¦åš UI æˆ–è€…æ–°çš„ç»„ä»¶æ—¶ï¼Œè¿˜æ˜¯éœ€è¦åœ¨ iOS å’Œ Android ä¸¤ç«¯ä¸Šéƒ½æœ‰å¯¹åº”æ¥å£çš„å®ç°æ‰è¡Œã€‚ç”±äºæœ‰ JavaScript æ¡¥æ¥è¿™ä¸€å±‚ï¼Œåœ¨æ€§èƒ½ä¸Šè¿˜æ˜¯ç¨å·®äºçº¯ Native å¼€å‘ã€‚ä½†æ˜¯å³ä¾¿äºæ­¤ï¼Œå®ƒä½å»‰çš„å­¦ä¹ æˆæœ¬ï¼Œä¸ Web å‰ç«¯å¼€å‘æ–¹å¼ä¸€æ ·æœ‰ç€ç›´è§‚æ˜“æ‡‚ï¼Œä»¥åŠæé«˜çš„å¼€å‘æ•ˆç‡ï¼Œå¾—åˆ°äº†å¼€å‘äººå‘˜ï¼ˆå°¤å…¶æ˜¯ Web å‰ç«¯ï¼‰çš„é’çã€‚
Flutter
Flutter å¯ä»¥è¯´æ˜¯è·¨å¹³å°è§£å†³æ–¹æ¡ˆçš„å†ä¸€æ¬¡è¿›åŒ–ï¼Œå®ƒç›´æ¥å€ŸåŠ© OpenGL é€šè¿‡ GPU æ¥ç»˜åˆ¶ UIï¼Œå¹¶ä¸”é€šè¿‡ C++ ç›´æ¥å’Œç³»ç»Ÿå±‚äº¤äº’ã€‚

![](/media/15635256320339/15638715825612.jpg)


Flutter å¯ä»¥è¯´åœ¨æ€§èƒ½æ›´åŠ çš„é«˜ï¼Œåœ¨è·¨å¹³å°è§£å†³æ–¹æ¡ˆä¸Šæ›´åŠ å½»åº•ï¼Œä½†æ˜¯å®ƒçš„å­¦ä¹ æ›²çº¿ç›¸å¯¹é™¡å³­ï¼Œå¹¶ä¸”åˆšåˆšèµ·æ­¥ï¼Œç”Ÿæ€è¿˜ä¸ºå½¢æˆï¼Œä¸è¿‡æ½œåŠ›è¿˜æ˜¯éå¸¸å¤§ã€‚

## 3ã€SwitfUI

### 3.1 ç®€ä»‹
2019å¹´ WWDC å¤§ä¼šä¸Šï¼Œè‹¹æœå®£å¸ƒäº†åŸºäºSwiftè¯­è¨€æ„å»ºçš„å…¨æ–°UIæ¡†æ¶-SwiftUIã€‚å…¶ç•Œé¢å¸ƒå±€å®Œå…¨æŠ›å¼ƒäº†Storyboardå’ŒAutolayoutï¼Œé‡‡ç”¨äº†å£°æ˜å¼çš„ç•Œé¢è¯­è¨€(DSLï¼Œå³Domain Specific Language)ï¼ŒåŠ ä¸Š Canvas çš„å®æ—¶é¢„è§ˆåŠŸèƒ½ï¼Œå¼€å‘ä½“éªŒæœ‰äº†å¾ˆå¤§çš„æå‡ã€‚
### 3.2  SwitfUIç‰¹ç‚¹

#### 3.2.1.Appleç»ˆäºåŠ å…¥äº†å£°æ˜æ€§UIç¼–ç¨‹çš„ç°ä»£æ—¶ä»£

å‘½ä»¤å¼ç¼–ç¨‹ï¼šå‘½ä»¤â€œæœºå™¨â€å¦‚ä½•å»åšäº‹æƒ…(how)ï¼Œè¿™æ ·ä¸ç®¡ä½ æƒ³è¦çš„æ˜¯ä»€ä¹ˆ(what)ï¼Œå®ƒä¼šæŒ‰ç…§ä½ çš„å‘½ä»¤å®ç°,æ˜¯ä¸€ç§é€šè¿‡è¯­å¥æ¥æ”¹å˜ç¨‹åºçŠ¶æ€çš„ç¼–ç¨‹èŒƒå¼ã€‚

å£°æ˜å¼ç¼–ç¨‹ï¼šå‘Šè¯‰â€œæœºå™¨â€ä½ æƒ³è¦çš„æ˜¯ä»€ä¹ˆ(what)ï¼Œè®©æœºå™¨æƒ³å‡ºå¦‚ä½•å»åš(how),æ˜¯ä¸€ç§ä¸ä½¿ç”¨æ§åˆ¶æµæ¥è¡¨ç¤ºè®¡ç®—é€»è¾‘çš„ç¼–ç¨‹èŒƒå¼ã€‚

``` 
å‘½ä»¤å¼ç¼–ç¨‹å¦‚ä¸‹
override func viewDidLoad() {
        super.viewDidLoad()
        let label = UILabel(frame: CGRect(x: 100, y: 100, width: 100, height: 100))
        label.text = "ä¸–ç•Œå’Œå¹³"
        label.textColor = .purple
        view.addSubview(label)
    }
```

``` 
ä½¿ç”¨SwiftUIå£°æ˜å¼ç¼–ç¨‹æ—¶ï¼Œåˆ™ï¼š
var body: some View {
     Text("ä¸–ç•Œå’Œå¹³")
            .color(.purple) 
    }
```

#### 3.2.2 å£°æ˜å¼ç¼–ç¨‹æœ‰å‡ ä¸ªä¼˜ç‚¹
* ä»£ç æ˜¯æè¿°ç¨‹åºåœ¨åšä»€ä¹ˆï¼Œå¯é˜…è¯»æ€§ä¼šå¤§å¤§æé«˜ï¼›
* ç»„ä»¶çŠ¶æ€æ›´å®¹æ˜“ç»´æŠ¤åœ¨å†…éƒ¨ï¼Œå‡å°‘å‰¯ä½œç”¨ï¼›
* ç»„ä»¶ä¹‹é—´çš„è¾¹ç•Œæ›´æ˜æ˜¾ï¼Œä»è€Œè®©ç»„ä»¶å¤ç”¨æ›´çµæ´»ã€‚
* Reactã€Flutter åŒ…æ‹¬åˆšå‡ºçš„ SwiftUI éƒ½é€‰æ‹©äº†å£°æ˜å¼çš„ UIï¼Œä»ä¸€ä¸ªä¾§é¢ä¹Ÿå°è¯äº†è¿™ä¸€ç‚¹ã€‚

#### 3.2.3 ç®€å•å¯¹æ¯”ä¸‹switfå’Œ dart

Swift æ¯” Dart æ›´åŠ ç®€æ´ã€‚Swift æœ¬èº«åœ¨è¯­æ³•å±‚é¢å·²ç»æ¯” Dart è¦ç®€æ´å¾ˆå¤šï¼Œæ¯”å¦‚æ— éœ€åœ¨å¥æœ«æ·»åŠ ;åˆ†å·ç­‰ã€‚è¿™ä¸€ç‚¹åœ¨ç›´æ¥ç¼–å†™ SwiftUI å’Œ Flutter ä¸Šä¼šæ˜¾å¾—å°¤ä¸ºæ˜æ˜¾ã€‚ä¸è¿‡è¿™ä¸ªé—®é¢˜å¹¶ä¸å…¨æ˜¯è¯­è¨€å±‚é¢å¸¦æ¥çš„é—®é¢˜ï¼Œä¹Ÿè·Ÿè¿™ä¸¤ä¸ª UI æ¡†æ¶çš„è®¾è®¡æœ‰å…³ã€‚


```
ForEach(userData.landmarks) { landmark in
  NavigationButton( destination: LandmarkDetail(landmark: landmark))
 {
    LandmarkRow(landmark: landmark)
  }
}
```

```SliverList(
  delegate: SliverChildBuilderDelegate(
    (context, index) {
      final landmark = landmarks[index];
      return LandmarkCell(
        landmark: landmark,
        onTap: () {
          Navigator.push(
            context,
            CupertinoPageRoute(
              builder: (context) => LandmarkDetail(
                landmark: landmark,
              ),
            ),
          );
        },
      );
    },
    childCount: landmarks.length,
  ),
),
```
### 3.3 switfUI ä¸€äº›å¿…é¡»äº†è§£çš„å†…å®¹
 **ç®€å•æ¥è¯´:SwiftUIæ˜¯ä¸€ä¸ªæƒŠäººçš„ç”¨æ¥æ„å»ºUIçš„ï¼Œå‡½æ•°å¼ç¼–ç¨‹ï¼ˆ functional programming ï¼‰ç¯å¢ƒ*
 åœ¨ UIKit æ—¶ä»£ï¼Œ æˆ‘ä»¬éœ€è¦èŠ±å¤§é‡çš„æ—¶é—´æ¥å†™åŸºæœ¬çš„ UIï¼›è€Œæœ‰äº† SwiftUI ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ›´å¤šçš„æ—¶é—´èŠ±åœ¨è‡ªå®šä¹‰åŠŸèƒ½å’Œä¸šåŠ¡é€»è¾‘ä¸Šï¼Œå€Ÿç”¨äº†è‹¹æœçš„å›¾ï¼Œå¯¹æ¯”å¦‚ä¸‹ï¼š![](/media/15635256320339/15639586368816.jpg)
 
![](/media/15635256320339/15639586449340.jpg)


#### 3.3.1å‡½æ•°å¼

1. æˆ‘ä»¬æ—©å·²ç»çŸ¥é“äº†ä»€ä¹ˆæ˜¯å‡½æ•°ã€‚å‡½æ•°åŸºæœ¬ä¸Šå°±æ˜¯ä¸€æ®µæ‹¬å·æ‹¬èµ·æ¥çš„ä»£ç ï¼Œå®ƒæ¥æ”¶å€¼è¿›æ¥ï¼Œå¹¶ä¸”è¿”å›ç»“æœå‡ºå»ã€‚è¿™ä¸å°±è§£é‡Šå®Œäº†å˜›ã€‚åœ¨SwiftUIä¸­ï¼Œè¿™äº›å‡½æ•°è¿”å›ä¸€äº›ç»„æˆUIçš„éƒ¨ä»¶ã€‚æˆ–è€…è¿™ä¹ˆè¯´ï¼Œæˆ‘ä»¬ç”¨è¿™äº›å‡½æ•°å£°æ˜UIã€‚
2. å‡½æ•°åµŒå¥—
  å‡½æ•°å¼ç¼–ç¨‹çš„å¦ä¸€æ–¹é¢å°±æ˜¯æˆ‘ä»¬é€šå¸¸åœ¨ä¸€ä¸ªå‡½æ•°é‡ŒåµŒå¥—å¦ä¸€ä¸ªå‡½æ•°ã€‚åœ¨SwiftUIä¸­ï¼Œæˆ‘ä»¬åŒæ ·è¿™æ ·åšã€‚
  è™½ç„¶è¿™çœ‹ä¸Šå»å¾ˆå¥‡æ€ªï¼Œä½†æ˜¯å¦‚æœä½ ä¸è¦å»æƒ³å®ƒï¼Œä½ å…¶å®æ—©å·²ä¹ æƒ¯è¿™æ ·æ€è€ƒäº†ã€‚æˆ‘ä»¬çš„UINavigationController åŒ…å«ä¸€ä¸ªUITableViewï¼Œtable viewåˆåŒ…å«ä¸€åˆ—UITableViewCellsï¼Œè¿™äº›cellé‡Œæœ‰åŒ…å«å…¶ä»–viewã€‚ ä¸€ä¸ªUIå…ƒç´ åŒ…å«å¦ä¸€ä¸ªå…ƒç´ ï¼Œè¢«åŒ…å«çš„å…ƒç´ æœ‰åŒ…å«ä¸€ä¸ªå…ƒç´ ......å¦‚æ­¤ä¸€ç›´åˆ°æ— ç©·ã€‚

```
struct ListView : View {
    var list = ["A", "B", "C"]
    var body: some View {
        NavigationView {
            List(list.identified(by: \.self)) { item in
                HStack {
                    Image(systemName: "circle")
                    Text(item)
                    Spacer()
                }
            }
            .navigationBarTitle(Text("Sample List"))
        }
```

#### 3.3.2 Views
åœ¨ UIKit ä¸­æœ‰ UIViewï¼Œåœ¨ AppKit ä¸­æœ‰ NSViewï¼Œè€Œåœ¨SwiftUIä¸­ï¼Œç»„æˆæˆ‘ä»¬UIéƒ¨ä»¶å«åšViewã€‚
æ–‡æœ¬ï¼ˆtextï¼‰ï¼Ÿå®ƒæ˜¯ä¸€ä¸ªViewã€‚ä¸€å¼ å›¾ç‰‡,åˆä¸€ä¸ªViewã€‚åˆ—è¡¨ï¼Ÿä¹Ÿæ˜¯viewï¼Œåˆ—è¡¨æ˜¯ä¸€ä¸ªåŒ…å«ä¸€åˆ—Viewçš„Viewã€‚
ä½†æ˜¯ä¸åƒUIKité‚£ä¹ˆåœ°ç¬¨é‡ï¼ŒSwiftUIçš„Viewéƒ½æ˜¯å¾ˆå°çš„ä¸€å—ï¼Œå½“ä»–ä»¬ç»„åˆèµ·æ¥ï¼Œæè¿°äº†æˆ‘ä»¬çš„UIã€‚
åœ¨ç”¨ UIKit å®ç°æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå®šä¹‰ä¸€å †çš„ UIViewå®ä¾‹ï¼Œç„¶åå†é€šè¿‡ addSubview() å»ç»„æˆ View çš„å±‚çº§å…³ç³»ã€‚è€Œä¸”ä»ä»£ç ä¸Šçœ‹ï¼Œæˆ‘ä»¬å¾ˆéš¾ä¸€çœ¼çœ‹å‡º View ä¹‹é—´çš„å±‚çº§å…³ç³»ã€‚ä½†æ˜¯åœ¨ SwiftUI å°±ä¸ä¸€æ ·äº†ï¼Œä¸‹é¢æ˜¯ SwiftUI çš„å®ç°ä»£ç ï¼š

```
VStack {
    Text("Avocado Toast").font(.title)
    
    Toggle(isOn: $order.includeSalt) {
        Text("Include Salt")
    }
    Toggle(isOn: $order.includeRedPepperFlakes) {
        Text("Include Red Pepper Flakes")
    }
    Stepper(value: $order.quantity, in: 1...10) {
        Text("Quantity: \(order.quantity)")
    }
    
    Button(action: submitOrder) {
        Text("Order")
    }
}
```
åœ¨ SwiftUI ä¸­ï¼Œç›´æ¥æŠŠ subview æ”¾åœ¨ superview åˆå§‹åŒ–æ–¹æ³•çš„ä¸€ä¸ª closure å‚æ•°é‡Œï¼Œè€Œä¸éœ€è¦å†è°ƒç”¨  addSubview()ï¼ŒView ä¹‹é—´çš„å±‚çº§å…³ç³»ä¸€ç›®äº†ç„¶ã€‚

##### åˆ°è¿™é‡Œï¼Œå¯ä»¥çœ‹å‡ºæ¥å‡ ç‚¹ï¼š
* UIKit çš„å®ç°è¿‡ç¨‹ï¼Œå…¶å®æ˜¯å±äºå‘½ä»¤å¼ç¼–ç¨‹ã€‚ä½ éœ€è¦ä¸€æ­¥æ­¥å‘Šè¯‰ç¨‹åºåšä»€ä¹ˆå’Œæ€ä¹ˆåšï¼Œä¾‹å¦‚å…ˆæŠŠå„ç§ view åˆå§‹åŒ–å¥½ï¼Œç„¶åæŠŠè¿™ä¸ª subview æ·»åŠ åˆ°é‚£ä¸ª superview é‡Œé¢ç­‰ï¼›
* SwiftUI çš„å®ç°è¿‡ç¨‹æ˜¯å£°æ˜å¼ç¼–ç¨‹ï¼Œä½ åªéœ€è¦å‘Šè¯‰ç¨‹åºä½ éœ€è¦ä»€ä¹ˆã€è¿™ä¸ªä¸œè¥¿æ”¾ç½®åœ¨å“ªé‡Œã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå‡è®¾ä½ æƒ³è®©æœ‹å‹åšä¸€ä¸ªç•ªèŒ„ç‚’è›‹ï¼šå‘½ä»¤å¼ç¼–ç¨‹å°±åƒæ˜¯ä½ æ•™æœ‹å‹åšç•ªèŒ„ç‚’è›‹ï¼Œå‘Šè¯‰ä»–ç¬¬ä¸€æ­¥æŠŠç•ªèŒ„æ´—å¹²å‡€ï¼Œç¬¬äºŒæ­¥æŠŠç•ªèŒ„åˆ‡ç‰‡ â€¦â€¦ ï¼›è€Œå£°æ˜å¼ç¼–ç¨‹å°±æ˜¯ä½ ç›´æ¥å‘Šè¯‰æœ‹å‹ï¼Œæˆ‘è¦åƒç•ªèŒ„ç‚’è›‹ï¼Œå°±è¿™ä¹ˆç®€å•ï¼Œè‡³äºæ€ä¹ˆåšå°±äº¤ç»™ä½ æœ‹å‹äº†ã€‚

#### 3.3.3 æ•°æ®ç»‘å®šview

> å½“æˆ‘ä»¬åœ¨SwiftUIä¸­å®šä¹‰ä¸€ä¸ªUIå…ƒç´ æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå‘Šè¯‰è¿™ä¸ªå…ƒç´ åˆ°å“ªå»æ‰¾å®ƒéœ€è¦çš„æ•°æ®ã€‚æœ‰äº›æ—¶å€™è¿™äº›ä¿¡æ¯æ˜¯é™æ€çš„ï¼Œå°±åƒä¸Šé¢å±•ç¤ºçš„text viewé‡Œçš„å­—ç¬¦ä¸²ã€‚

1.ç®€å•çš„æ•°æ®ç»‘å®š
æœ‰äº›æ—¶å€™ï¼Œé‚£äº›ä¿¡æ¯æ˜¯ç”±æˆ‘ä»¬çš„æ•°æ®é©±åŠ¨çš„ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œåœ¨åˆ«å¤„åˆå§‹åŒ–çš„æ•°æ®ä¼ ç»™list viewï¼Œlist viewä½¿ç”¨è¿™ä¸ªæ•°æ®æ¥å±•ç¤ºå†…å®¹ã€‚

```
struct ListView : View {
    var list: [String]
    var body: some View {
        NavigationView {
            List(list.identified(by: \.self)) { item in
                HStack {
                    Image(systemName: "circle")
                    Text(item)
                    Spacer()
                }
            }
            .navigationBarTitle(Text("Sample List"))
        }
        
```

ç¬¬ä¸€ä¸ªä¼ ç»™listçš„å‚æ•°å‘Šè¯‰å®ƒåˆ°å“ªå»æ‰¾å®ƒéœ€è¦çš„æ•°æ®ã€‚
Listä¼šä»æ•°ç»„é‡Œå–å‡ºå…ƒç´ ï¼ŒæŠŠå®ƒä¼ åˆ°é—­åŒ…é‡Œã€‚åœ¨é—­åŒ…é‡Œï¼Œä½¿ç”¨è¿™ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ ï¼Œæ„å»ºå¹¶è¿”å›äº†ä¸€ä¸ªå±•ç¤ºè¿™ä¸ªå…ƒç´ çš„viewã€‚
æ‰€æœ‰è¿™äº›å‘ç”Ÿåœ¨ä¸éœ€è¦æ•°æ®æºï¼ˆdata sourceï¼‰å’Œä»£ç†ï¼ˆdelegateï¼‰çš„æƒ…å†µä¸‹ã€‚ä¸Šé¢çš„ä»£ç å¯ä»¥åœ¨ä½ çš„Appä¸­æˆä¸ºå®Œæ•´çš„ï¼Œæ­£ç¡®å·¥ä½œçš„ä¸€å±å†…å®¹ã€‚

1.åŠ¨æ€çš„æ•°æ®ç»‘å®š
æœ‰äº›æ—¶å€™æˆ‘ä»¬çš„ä¿¡æ¯æ˜¯åŠ¨æ€çš„ï¼Œå¯èƒ½ä¼šæ”¹å˜ï¼Œæˆ‘ä»¬çš„UIåº”è¯¥èƒ½å¤Ÿæ­£ç¡®çš„éšä¹‹è°ƒæ•´ã€‚

```
struct ListView: View {
    @Binding var list: [String]
    @Binding var title: String
    var body: some View {
        NavigationView {
            List(list.identified(by: \.self)) { item in
                HStack {
                    Image(systemName: "circle")
                    Text(item)
                    Spacer()
                }
            }
            .navigationBarTitle(Text(title))
            
```
       
ä¸Šé¢çš„å®ç°å‡ ä¹ä¸ç¬¬ä¸€ä¸ªå®ç°ä¸€æ ·ï¼Œä½†æ˜¯æœ€å¤§çš„ä¸åŒåœ¨äºè¢«æ·»åŠ åˆ°listå’Œtitleå˜é‡ä¸Šçš„@Bindingå±æ€§å°è£…å™¨ï¼ˆproperty wrapper ï¼‰ã€‚
Bindingå‘Šè¯‰SwiftUIçœ‹ç€listæ•°ç»„ï¼Œä»¥é˜²å®ƒå˜åŒ–ã€‚
listæ•°ç»„è¢«æ›´æ–°åï¼Œlist viewéšä¹‹æ›´æ–°å’Œæ¸²æŸ“--è‡ªåŠ¨åœ°
ä½ åº”è¯¥æ„è¯†åˆ°ï¼ŒListæ˜¯ä¸€ä¸ªéå¸¸èªæ˜çš„å°viewã€‚listæ•°ç»„æ’å…¥æˆ–åˆ é™¤æ¡ç›®åï¼ŒListå¯ä»¥çŸ¥é“è¿™äº›æ”¹å˜ï¼Œå¹¶ä¸”æ‰«ææ›´æ–°åçš„listæ•°ç»„ï¼Œä¸ä¹‹å‰çš„liståšæ¯”è¾ƒï¼Œç„¶åä¸ºä½ äº§ç”Ÿæ­£ç¡®çš„æ’å…¥æˆ–åˆ é™¤åŠ¨ç”»ã€‚
å¹¶ä¸”ï¼Œæ³¨æ„åˆ°æˆ‘ä»¬ç°åœ¨ç»™navigation barä¼ é€’äº†ä¸€ä¸ªtitleã€‚è¿™ä¸ªtitleä¹Ÿæ˜¯ç»‘å®šçš„ï¼Œæ‰€ä»¥å½“å®ƒæ”¹å˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„titlebarä¹Ÿä¼šè‡ªåŠ¨åœ°æ›´æ–°ã€‚

* @Stateï¼šå½“æŸ¥çœ‹æ‰€éœ€è¦çš„å±æ€§åªåœ¨å½“å‰æŸ¥çœ‹å’Œå®ƒçš„å„¿ç«¥è§†å›¾ä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨ç”¨æˆ·çš„æ“ä½œè¿‡ç¨‹ä¸­ä¼šå‘ç”Ÿå˜åŒ–ï¼Œç„¶åå¯¼è‡´æŸ¥çœ‹éœ€è¦ä½œå‡ºæ”¹å˜ï¼Œé‚£ä¹ˆä½¿ç”¨@Stateã€‚å› ä¸ºåªåœ¨å½“å‰æŸ¥çœ‹å’Œå®ƒçš„Child Viewsä¸­ä½¿ç”¨ï¼Œè·Ÿå¤–ç•Œæ— å…³ï¼Œæ‰€ä»¥è¢«@Stateæ ‡è®°çš„å±æ€§ä¸€èˆ¬åœ¨å®šä¹‰æ—¶å°±æœ‰åˆå§‹å€¼ã€‚

* @Bindingï¼šå½“æŸ¥çœ‹æ‰€éœ€è¦çš„å±æ€§æ˜¯ä»å®ƒçš„ç›´æ¥çˆ¶è§†å›¾ä¼ å…¥ï¼Œåœ¨å†…éƒ¨ä¼šå¯¹è¿™ä¸ªå±æ€§è¿›è¡Œä¿®æ”¹ï¼Œå¹¶ä¸”ä¿®æ”¹åçš„å€¼éœ€è¦åé¦ˆç»™ç›´æ¥çˆ¶è§†å›¾ï¼Œé‚£ä¹ˆä½¿ç”¨@Bindingã€‚

* @ObjectBindingï¼šç”¨äºç›´æ¥ç»‘å®šå¤–éƒ¨çš„æ•°æ®æ¨¡å‹å’ŒViewã€‚

* @EnvironmentObjectï¼šRoot Viewé€šè¿‡environmentObject()æŠŠBindableObjectæ³¨å…¥åˆ°æŸ¥çœ‹å±‚çº§ä¸­ï¼Œå…¶ä¸­çš„æ‰€æœ‰å­è§†å›¾å¯ä»¥é€šè¿‡@EnvironmentObjectæ¥è®¿é—®è¢«æ³¨å…¥çš„BindableObjectã€‚

ç»‘å®šï¼ˆBindingï¼‰åªæ˜¯ç®¡ç†å’Œç»´æŠ¤ä½ çš„åº”ç”¨ä¸­çš„çŠ¶æ€ï¼ˆstateï¼‰çš„æ‰‹æ®µä¹‹ä¸€ã€‚å®Œå…¨çš„è®¨è®ºæ‰€æœ‰çš„æ‰‹æ®µè¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ï¼Œæ‰€ä»¥æˆ‘å°±ä¸åšè¿‡å¤šé˜è¿°ã€‚
å¦‚æœæœ‰äººæ„Ÿå…´è¶£å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç«  https://www.jianshu.com/p/c74691f5ca79

#### 3.3.4ä¿®æ”¹å™¨ï¼ˆModifiersï¼‰

```
Text("Avocado Toast").font(.title)
```
å‰åŠéƒ¨åˆ† Text("Avocado Toast") æ˜¯ä¸€ä¸ª Viewï¼Œè€ŒååŠéƒ¨åˆ† font(.title) å°±æ˜¯ä¸€ä¸ª Modifierã€‚

ä¸¥æ ¼åœ°è¯´ï¼Œä¸€ä¸ªmodifieræ˜¯ä¸€ä¸ªviewçš„è¿ç®—ç¬¦ï¼ˆoperatorï¼‰...å®ƒè¿”å›å¦ä¸€ä¸ªview...è¿™ä¸ªviewå¯ä»¥è¢«ä¿®æ”¹ï¼Œæ°¸æ— æ­¢å¢ƒï¼ˆç›´åˆ°å†…å­˜æº¢å‡ºï¼‰
ä»ä¸€ä¸ªç‰¹å®šè§’åº¦æ¥è¯´ï¼Œä½ åšçš„æ‰€æœ‰äº‹æƒ…éƒ½æ˜¯ç”¨SwiftUIçš„viewå’Œoperatoræ¥ç»™SwiftUIè¿™ä¸ªæ¡†æ¶æè¿°UIï¼Œç”¨åˆ°çš„è¯å’Œä½ è·Ÿå¦ä¸€ä¸ªå¼€å‘è€…æè¿°ä½ çš„UIæ—¶ç”¨åˆ°çš„è¯å‡ ä¹ä¸€æ¨¡ä¸€æ ·ã€‚
â€œæˆ‘æƒ³è¦ä¸€ä¸ªå…è´£å£°æ˜çš„åœ¨é‚£ï¼Œç”¨è„šæ³¨å­—ä½“å’Œå¤§å°ï¼Œå†ç»™å®ƒè®¾ç½®ä¸ªé¢œè‰²ï¼Œè®©å®ƒåœ¨æ·±è‰²æ¨¡å¼ä¸‹ä¹Ÿèƒ½çœ‹èµ·æ¥é¡ºçœ¼ã€‚â€
è¿™æ˜¯ä¸€ä¸ªæœ‰ä¸¤ä¸ªmodifierçš„UIå…ƒç´ ã€‚

```
å¦å¤–è¿˜å¯ä»¥é€šè¿‡é“¾å¼è¯­æ³•ä¿®æ”¹æ›´å¤šå±æ€§
Text("Your mileage my vary.")
    .font(.footnote)
    .foregroundColor(.secondary)
```
å‘SwiftUIæè¿°ä¸Šè¿°å†…å®¹ï¼Œå®ƒä¼šæŠŠå‰©ä¸‹çš„å·¥ä½œåšå®Œï¼Œç»™ç”¨åˆé€‚çš„é—´è·ã€è¡Œè·ã€å­—ä½“ç»™æ–‡å­—å¸ƒå±€ã€‚
![](/media/15635256320339/15639529705423.jpg)


æ¯æ·»åŠ ä¸€ä¸ª Modifierï¼ŒViewå±‚çº§å°±ä¼šä¸æ–­å˜å¾—å¤æ‚ã€‚ä½†æ˜¯ï¼ŒSwiftUI å¯ä»¥å¾ˆç†Ÿç»ƒæ ¹æ® View å±‚çº§æŠŠæˆ‘ä»¬çš„ Views è¿›è¡Œæ¸²æŸ“ã€‚æ‰€ä»¥å³ä½¿æˆ‘ä»¬æŠŠ TextåŒ…è£…åœ¨å¤šä¸ª Wrapper Viewsï¼ŒSwiftUI ä¼šåœ¨åº•å±‚æ•´ç†æˆä¸€ä¸ªé«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œç„¶åè¢«æ¸²æŸ“ç³»ç»Ÿä½¿ç”¨ã€‚
ç¬¬ä¸€ï¼ŒModifier Chains å¯ä»¥ä»¥å¯è§†åŒ–çš„æ•ˆæœæ‰§è¡Œç¡®å®šé¡ºåºã€‚ æˆ‘ä»¬æ¥çœ‹è¿™ç»„ä»£ç ï¼š

```
Text("ğŸğŸ¥‘")
    .background(Color.green, cornerRadius: 12)
    .padding(.all)

Text("ğŸğŸ¥‘")
    .padding(.all)
    .background(Color.green, cornerRadius: 12)
```

![](/media/15635256320339/15639532259983.jpg)![](/media/15635256320339/15639532390143.jpg)

ç¬¬äºŒï¼ŒModifier å¯ä»¥åŒæ—¶å¯¹å¤šä¸ª View è¿›è¡Œä¿®æ”¹ã€‚ä¾‹å¦‚ï¼š

```
VStack(alignment: .leading) {
    Toggle(isOn: $order.includeSalt) { ... }
        .opacity(0.5)
    Stepper(value: $order.quantity, in: 1...10) { ... }
        .opacity(0.5)
    Button(action: submitOrder) { ... }
        .opacity(0.5)
}
```
```
VStack(alignment: .leading) {
    Toggle(isOn: $order.includeSalt) { ... }
    Stepper(value: $order.quantity, in: 1...10) { ... }
    Button(action: submitOrder) { ... }
}
.opacity(0.5)
```
æ€»ä¹‹ï¼Œå®ƒå°½å…¨åŠ›å¤„ç†å¥½æŒ‘å‰”çš„ç»†èŠ‚ï¼Œå¹¶ä¸”åœ¨ä½ UIçš„æ¯ä¸€ä¸ªéƒ¨åˆ†éƒ½é‚£ä¹ˆåšã€‚è¿™è§£æ”¾äº†ä½ ï¼Œä½œä¸ºå¼€å‘è€…ï¼Œä½ åªéœ€è¦å…³å¿ƒä½ Appçš„åŠŸèƒ½ï¼Œä¸šåŠ¡é€»è¾‘å’Œæ•°æ®ã€‚

#### 3.3.5.åŸºæœ¬å¸ƒå±€

SwiftUIæ˜¯æ€ä¹ˆè¿›è¡Œå¸ƒå±€
åœ¨SwiftUIé‡Œä¸Šé¢Textçš„å£°æ˜åªæ˜¯çº¯æ•°æ®ç»“æ„çš„æè¿°ï¼Œå¹¶ä¸æ˜¯å®é™…æ˜¾ç¤ºå‡ºæ¥çš„è§†å›¾ï¼ŒSwiftUI ä¼šç›´æ¥è¯»å– DSL å†…éƒ¨æè¿°ä¿¡æ¯å¹¶æ”¶é›†èµ·æ¥ï¼Œç„¶åè½¬æ¢æˆåŸºæœ¬çš„å›¾å½¢å•å…ƒï¼Œæœ€ç»ˆäº¤ç»™åº•å±‚ Metal æˆ– OpenGL æ¸²æŸ“å‡ºæ¥ã€‚
åœ¨ SwiftUI ä¸­Textå±æ€§çš„è®¾ç½®åœ¨å†…éƒ¨éƒ½ä¼šç”¨ä¸€ä¸ªè™šæ‹Ÿçš„ View æ¥æ‰¿è½½ï¼Œç„¶ååœ¨å¼€å§‹å¸ƒå±€çš„æ—¶å€™å†è¿›è¡Œå¸ƒå±€è®¡ç®—ï¼Œè¿™æ ·åšçš„ç›®çš„ä¸»è¦æ˜¯æ–¹ä¾¿åº•å±‚åœ¨è®¾è®¡æ¸²æŸ“å‡½æ•°æ—¶æ›´å®¹æ˜“åšåˆ° monomorphic callï¼Œçœå»æ— ç”¨çš„åˆ†æ”¯åˆ¤æ–­ï¼Œæé«˜æ•ˆç‡ã€‚

åœ¨åˆšåˆ›å»ºå¥½ä¸€ä¸ª SwiftUI é¡¹ç›®æ—¶ï¼ŒXcode ç»™æˆ‘ä»¬å‡†å¤‡äº†æ¨¡æ¿ä»£ç ï¼š

```
struct ContentView : View {
    var body: some View {
        Text("Hello World")
    }
}
```
![](/media/15635256320339/15639551059771.jpg)

æœ¬è´¨ä¸Šæ¥è¯´ï¼Œè¿™ä¸ªä¾‹å­æœ‰ä¸‰ä¸ª Viewï¼š
1ï¼‰æœ€åº•å±‚çš„ Root Viewï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªæ‰‹æœºå±å¹•é™¤å»ç•™æµ·å±çš„éƒ¨åˆ†ï¼›
2ï¼‰å¤„äºä¸­é—´çš„ ContentViewï¼Œé¢„è§ˆå›¾ä½“ç°ä¸å‡ºæ¥ï¼Œå› ä¸ºå®ƒå’Œ Text ä¸€æ ·å¤§ï¼›
3ï¼‰æœ€é¡¶å±‚çš„ Textã€‚ä½†æ˜¯å› ä¸º ContentView çš„å¤§å°æ˜¯æœ‰å®ƒçš„ Child View Text å†³å®šçš„ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ª View å±‚çº§ç®€åŒ–æˆåªæœ‰  Root View å’Œ Text

HStack å’Œ VStack
å€Ÿç”¨å®˜æ–¹çš„ Demoï¼ŒUIä»£ç å¦‚ä¸‹

```
HStack {
    VStack {
        Text("â˜…â˜…â˜…â˜…â˜…")
        Text("5 stars")
    }.font(.caption)
    VStack(alignment: .leading) {
        HStack {
            Text("Avocado Toast").font(.title)
            Spacer()
            Image("20x20_avocado")
        }
        Text("Ingredients: Avocado, Almond Butter, Bread, Red Pepper Flakes")
            .font(.caption).lineLimit(1)
    }
}
```
![](/media/15635256320339/15639555059357.jpg)
æˆ‘ä»¬æ‹¿ HStack ä½œä¸ºä¾‹å­ï¼Œè®²è§£ä¸€ä¸‹ Stack æ˜¯å¦‚æœå·¥ä½œçš„ã€‚å‡è®¾æœ‰ä»¥ä¸‹ä»£ç ï¼š


```
HStack {
    Text("Delicious")
    Image("20x20_avocado")
    Text("Avocado Toast")
}
.lineLimit(1)
```
![](/media/15635256320339/15639557386837.jpg)

1.é¦–å…ˆ HStack å…ˆé¢„ç•™åˆé€‚çš„å®½åº¦ç»™ spacingï¼Œæ‰€ä»¥ HStack çš„å¯ç”¨ç©ºé—´ä¸ºæ‰€æœ‰å¯ç”¨å®½åº¦å‡å» S0 + S1ï¼š
![](/media/15635256320339/15639557803914.jpg)

![](/media/15635256320339/15639558221737.jpg)

2.å› ä¸ºæ€»å…±æœ‰ä¸‰ä¸ª Child Viewsï¼Œæ‰€ä»¥ HStack å…ˆæŠŠå‰©ä½™å¯ç”¨å®½åº¦å¹³å‡åˆ†é…ç»™ä¸‰ä¸ª Child Viewsï¼š

![](/media/15635256320339/15639558513160.jpg)

3.å› ä¸º Image çš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥ Image å…ˆç¡®å®šå®ƒçš„æ‰€éœ€å®½åº¦ï¼Œç„¶åä»å¯ç”¨å®½åº¦å‡å» Image çš„å®½åº¦ï¼š
![](/media/15635256320339/15639558816270.jpg)

4.å‰©ä¸‹ä¸¤ä¸ª Child Viewsï¼Œæ‰€ä»¥ HStack åˆæŠŠå‰©ä½™å¯ç”¨å®½åº¦å¹³å‡åˆ†é…ç»™ä¸¤ä¸ª Child Views
![](/media/15635256320339/15639559073002.jpg)
5.Delicious ç¡®å®šå®ƒçš„æ‰€éœ€å®½åº¦ï¼ŒHStack ä»å¯ç”¨å®½åº¦å‡å» Delicious çš„å®½åº¦ï¼š
![](/media/15635256320339/15639560141489.jpg)

6.å‰©ä¸‹çš„å¯ç”¨å®½åº¦å…¨éƒ¨åˆ†é…ç»™ Avocado Toastï¼š
![](/media/15635256320339/15639559566061.jpg)

7.æ‰€æœ‰ Child Views æ°´å¹³æ–¹å‘çš„ä½ç½®éƒ½ç¡®å®šäº†ï¼Œé‚£ä¹ˆå‰©ä¸‹å‚ç›´æ–¹å‘ã€‚HStackå‚ç›´æ–¹å‘çš„å¯¹é½æ–¹å¼é»˜è®¤æ˜¯ centerï¼Œæ‰€ä»¥å®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š

```
// alignment é»˜è®¤æ˜¯ center
HStack(alignment: .center) {
    Text("Delicious")
    Image("20x20_avocado")
    Text("Avocado Toast")
}
.lineLimit(1)

```
å¦‚æœæ°´å¹³æ–¹å‘çš„ç©ºé—´ä¸å¤Ÿï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆä¸‹é¢è¿™ç§æ•ˆæœï¼š
![](/media/15635256320339/15639560696134.jpg)


è¿™æ—¶æˆ‘ä»¬è§‰å¾—åé¢çš„æ–‡å­—æ¯”è¾ƒé‡è¦ï¼Œæƒ³è®©å®ƒä¼˜å…ˆæ˜¾ç¤ºå®Œæ•´ï¼Œå¯ä»¥ä½¿ç”¨ Layout Priorityã€‚ä»£ç å¦‚ä¸‹ï¼š


```
HStack {
    Text("Delicious")
    Image("20x20_avocado")
    Text("Avocado Toast").layoutPriority(1)
}
.lineLimit(1)
```
![](/media/15635256320339/15639561524112.jpg)

ä½¿ç”¨äº† Layout Priority åï¼ŒHStack å°±ä¼šä¼˜å…ˆæ»¡è¶³é™¤äº†æœ€å¤§ä¼˜å…ˆçº§å¤–çš„æ‰€æœ‰ Child Views çš„æœ€å°æ‰€éœ€å®½åº¦ã€‚å‰é¢æ–‡å­—çš„æ‰€éœ€æœ€å°å®½åº¦æ˜¯ ... çš„å®½åº¦ï¼Œå›¾ç‰‡æ‰€éœ€æœ€å°å®½åº¦å°±æ˜¯å®ƒçš„å®½åº¦ï¼Œæ‰€ä»¥ HStack æŠŠæ‰€æœ‰å¯ç”¨å®½åº¦å‡å»å‰é¢æ–‡å­—å’Œå›¾ç‰‡çš„æ‰€éœ€æœ€å°å®½åº¦ï¼Œå‰©ä¸‹çš„å¯ç”¨å®½åº¦å…¨éƒ¨åˆ†é…ç»™ Avocado Toastã€‚å¦‚æœè¿˜æœ‰æ›´å¤šè¾ƒä½ä¼˜å…ˆçº§çš„ Child Viewsï¼Œé‚£ä¹ˆä¼šé‡å¤ä½¿ç”¨åŒæ ·çš„é€»è¾‘å»è¿›è¡Œå®½åº¦çš„åˆ†é…ã€‚
Alignment
ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ centerï¼Œæˆ‘ä»¬å¯ä»¥æ”¹ä¸º bottomï¼Œä»£ç å¦‚ä¸‹ï¼š

```
HStack(alignment: .bottom) {
    Text("Delicious")
    Image("20x20_avocado")
    Text("Avocado Toast")
}
.lineLimit(1)
```
![](/media/15635256320339/15639563694241.jpg)

å¦‚æœæƒ³è¦ç…§ç€sketché‚£ç§UI,å°±è¦è‡ªå®šä¹‰alignment äº†,è¿™é‡Œå°±ä¸è¯´äº†

#### 3.3.6è‡ªå®šä¹‰ View
åœ¨ä½¿ç”¨ UIKit æ—¶ï¼Œæ‰€æœ‰çš„è‡ªå®šä¹‰ Viewï¼Œéƒ½éœ€è¦ç»§æ‰¿è‡ª UIViewã€‚åœ¨ SwiftUI ä¸­ï¼Œä¹Ÿæ˜¯ç±»ä¼¼çš„æ€æƒ³ï¼Œä¸åŒçš„æ˜¯ä» UIView ï¼ˆç±»ï¼‰å˜æˆäº† View ï¼ˆåè®®ï¼‰ã€‚
æˆ‘ä»¬ä»”ç»†çœ‹ä¸€ä¸‹ SwiftUI ä¸­çš„ Viewå®šä¹‰ï¼š

```
public protocol View : _View {
    associatedtype Body : View
    var body: Self.Body { get }
}
```
ä¸åƒ UIKit ä¸­çš„ UIViewå­˜å‚¨äº†å¤§é‡çš„å±æ€§ï¼ŒSwiftUI ä¸­çš„ View å˜å¾—éå¸¸è½»é‡åŒ–ï¼Œåªéœ€è¦å®ç°ä¸€ä¸ª body å±æ€§å³å¯ï¼ŒView çš„å±æ€§å…¨éƒ¨é€šè¿‡ Modifiers å»ä¿®æ”¹ã€‚ä¸‹é¢çœ‹ä¸€ä¸ªå®˜æ–¹è§†é¢‘ä¸­çš„ä¸€ä¸ªè‡ªå®šä¹‰ Viewï¼š

```
struct OrderHistory : View {
    let previousOrders: [CompletedOrder]
    
    var body: some View {
        List(previousOrders) { order in
            VStack(alignment: .leading) {
                Text(order.summary)
                Text(order.purchaseDate)
                    .font(.subheadline)
                    .foregroundColor(.secondary)
            }
        }
    }
}
```
åœ¨ SwiftUI ä¸­ï¼Œæ‰€æœ‰çš„è‡ªå®šä¹‰ View éƒ½æ˜¯é€šè¿‡ struct å»å®šä¹‰çš„ï¼Œå¹¶å®ç° View åè®®å³å¯ã€‚æˆ‘ä»¬å‰é¢è®²è¿‡ï¼ŒSwiftUI çš„æ ¸å¿ƒæ€æƒ³æ˜¯å£°æ˜å¼ç¼–ç¨‹ï¼Œæ‰€ä»¥ SwiftUI ä¸­çš„ View ä¸å†æ˜¯ä¸€ä¸ªæˆ‘ä»¬æŒç»­ä¿®æ”¹å¹¶æ°¸ä¹…å­˜åœ¨çš„å¯¹è±¡ï¼Œè€Œæ›´åƒæ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œå¤–éƒ¨ç»™æˆ‘æ€æ ·çš„æ•°æ®ï¼Œæˆ‘å°±ç»™ä½ æ€æ ·çš„ Viewï¼Œæ•°æ®ä¸€æ ·ï¼Œè¿”å›çš„ View å°±ä¸€æ ·ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ View åè®®åªæœ‰ä¸€ä¸ªåªè¯»å±æ€§ bodyçš„åŸå› ã€‚

ä¸Šé¢ä»£ç ä¸­çš„ List æ˜¯ä¸€ä¸ªæ¼”ç¤ºå£°æ˜å¼ç¼–ç¨‹å¦‚æ­¤å¼ºå¤§çš„ä¾‹å­ï¼šå½“ previousOrders å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒSwiftUI ä¼šæŠŠæ–°æ•°æ®å’Œæ—§æ•°æ®è¿›è¡Œå¯¹æ¯”ï¼Œç„¶åæ ¹æ®æ•°æ®çš„å˜åŒ–éå¸¸é«˜æ•ˆåœ°æ›´æ–° UIï¼Œå¹¶ä¸”æœ‰å¯¹åº”çš„åˆ é™¤å’Œå¢åŠ çš„åŠ¨ç”»ã€‚è¿™ä¸€æ•´ä¸ªå¤æ‚çš„è¿‡ç¨‹ï¼Œæ— éœ€å†™ä¸€è¡Œä»£ç ï¼›è€Œåœ¨ UIKit ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å†™å¾ˆå¤šä»£ç å»åº”å¯¹æ•°æ®çš„å˜åŒ–ã€‚




#### 3.3.7ç¯å¢ƒï¼ˆenvironmentï¼‰
å¦ä¸€ä¸ªé¢å¤–çš„åº”è¯¥è¢«æåŠçš„æ–¹é¢å°±æ˜¯ç¯å¢ƒï¼ˆenvironmentï¼‰ã€‚
åœ¨SwiftUIä¸­ï¼Œenvironmentæ˜¯ä¸€ä¸ªå…¨å±€çš„å˜é‡é›†åˆï¼Œç”¨æ¥æè¿°appè¿è¡Œçš„ç¯å¢ƒã€‚åƒæ˜¯åœ¨æµ…è‰²è¿˜æ˜¯æ·±è‰²æ¨¡å¼ï¼Ÿæ¨ªå±è¿˜æ˜¯ç«–å±ï¼Ÿ
è¿™äº›å¯ä»¥è¢«æŸ¥è¯¢çš„å˜é‡å†³å®šäº†å½“å‰è®¾å¤‡çš„çŠ¶æ€ï¼Œå¹¶ä¸”appå› ä¸ºæœ‰äº†è¿™äº›å˜é‡å°±å¯ä»¥åœ¨æ­£ç¡®çš„æ—¶é—´åšæ­£ç¡®çš„äº‹ã€‚
ä½ ä¹Ÿå¯ä»¥å°†è‡ªå·±çš„ä¿¡æ¯åŠ å…¥åˆ°environmentï¼Œç¨åå†è·å–å®ƒã€‚

```
@EnvironmentObject var settings: UserSettings
@Environment(\.colorScheme) var colorScheme: ColorScheme

```
è¿™ä¹Ÿæœ‰ç‚¹è¶…å‡ºæœ¬æ–‡è®¨è®ºçš„å†…å®¹äº†ï¼Œä½†æ˜¯ä½ éœ€è¦çŸ¥é“å®ƒçš„å­˜åœ¨ã€‚

##### å°ç»“:
æ‰€ä»¥ï¼Œä½ å£°æ˜ä½ çš„UIå¹¶ä¸”ä½ ç»™SwiftUIæŒ‡å‡ºäº†æ•°æ®åœ¨å“ª...ç„¶åSwiftUIåšå‰©ä¸‹çš„äº‹ã€‚
æ¯ä¸ªViewï¼Œå®ƒçš„modifierçš„çŠ¶æ€ï¼Œå®ƒçš„æ•°æ®å’Œå½“å‰ç¯å¢ƒçš„çŠ¶æ€ç»„åˆèµ·æ¥ï¼Œç¼©å‡æˆä¸€ç³»åˆ—å¸ƒå±€å’Œæ¸²æŸ“å‘½ä»¤ã€‚å…¶ç»“æœä¼šå±•ç¤ºç»™ç”¨æˆ·ã€‚
ç„¶åï¼ŒSwiftUIä¼šç­‰å¾…æ•°æ®çš„å˜åŒ–ã€‚ä¸€æ—¦å‘ç”Ÿï¼ŒSwiftUIä¼šæ‰¾åˆ°å—å½±å“çš„viewå¹¶ä¸”æ„å»ºæ–°çš„å¸ƒå±€æ ‘ï¼Œæ¯”è¾ƒä¸å½“å‰æ ‘ä¸åŒçš„åœ°æ–¹ï¼Œç„¶åæ¸²æŸ“éœ€è¦æ›´æ–°çš„é‚£éƒ¨åˆ†ã€‚
è¿™ä½¿å¾—SwiftUIä¸UIKitç›¸æ¯”ï¼Œéå¸¸å¿«ã€‚å®é™…ä¸Šï¼Œå¤šæ•°viewå’ŒåŠ¨ç”»ç›´æ¥ç”±Metalæ¸²æŸ“ã€‚

æœ€å
å°±è¿™æ ·äº†ã€‚å¸Œæœ›ä½ ç°åœ¨èƒ½æ˜ç™½å½“Appleè¯´SwiftUIæ˜¯ä¸€ä¸ªæ–°çš„ï¼Œå£°æ˜å¼å¼çš„æ„å»ºç”¨æˆ·ç•Œé¢çš„ç¼–ç¨‹æ¡†æ¶çš„æ—¶å€™æ˜¯ä»€ä¹ˆæ„æ€ã€‚
å¹¶ä¸”é‚£ä¸ªæƒŠäººçš„modifierä¹Ÿå­¦åˆ°äº†ã€‚

**è¡¥å……**
swiftUIæ§ä»¶
![](/media/15635256320339/15639388231461.jpg)



### APP çš„å¯åŠ¨

1.åœ¨ç¤ºä¾‹ä¸­ï¼Œappåœ¨AppDelegateä¸­é€šè¿‡application(_:configurationForConnecting:options)è¿”å›ä¸€ä¸ªUISceneConfigurationå®ä¾‹ï¼š

```
func application(_ application: UIApplication, configurationForConnecting connectingSceneSession: UISceneSession, options: UIScene.ConnectionOptions) -> UISceneConfiguration {
        return UISceneConfiguration(name: "Default Configuration", sessionRole: connectingSceneSession.role)
    }
```
2.è¿™éƒ¨åˆ†å†…å®¹æ˜¯ iOS 13 ä¸­æ–°åŠ å…¥çš„é€šè¿‡ Scene ç®¡ç† app ç”Ÿå‘½å‘¨æœŸçš„æ–¹å¼ï¼Œä»¥åŠå¤šçª—å£æ”¯æŒéƒ¨åˆ†æ‰€éœ€è¦çš„ä»£ç ã€‚åœ¨ app å®Œæˆå¯åŠ¨åï¼Œæ§åˆ¶æƒè¢«äº¤æ¥ç»™ SceneDelegateï¼Œå®ƒçš„ scene(_:willConnectTo:options:)å°†ä¼šè¢«è°ƒç”¨ï¼Œè¿›è¡Œ UI çš„é…ç½®


```
func scene(_ scene: UIScene, willConnectTo session: UISceneSession, options connectionOptions: UIScene.ConnectionOptions) {
        let window = UIWindow(frame: UIScreen.main.bounds)
        window.rootViewController = UIHostingController(rootView: ContentView())
        self.window = window
        window.makeKeyAndVisible()
    }
    
```

3.è¿™æ®µä»£ç åˆ™è·Ÿä¹‹å‰iOS appå¯åŠ¨å¾ˆç±»ä¼¼ï¼Œå”¯ä¸€ä¸åŒçš„å°±æ˜¯rootViewControllerä¸ºUIHostingControllerç±»å‹çš„ï¼ŒUIHostingControlleræ˜¯UIViewControllerçš„å­ç±»ï¼Œä¸»è¦è´Ÿè´£æ¥å—ä¸€ä¸ªSwiftUIçš„Viewçš„æè¿°å¹¶å°†å…¶ç”¨UIKitè¿›è¡Œæ¸²æŸ“ï¼Œç”±äºè¿™ç§ç»§æ‰¿å…³ç³»ï¼Œæ‰€ä»¥å¯ä»¥åšåˆ°å°†SwiftUIæ„å»ºçš„ç•Œé¢å¯ä»¥é›†æˆåˆ°å·²æœ‰çš„UIKit appä¸­ï¼Œä¸éœ€è¦ä»å¤´å¼€å§‹å°±æ˜¯åŸºäºSwiftUIçš„æ„å»º

##### è¡¥å……:
some View

```
struct ContentView: View {
    var body: some View {
        Text("ä¸–ç•Œå’Œå¹³")
            .color(.purple)
    }
}
```
ä»SceneDelegateè¿›å…¥åˆ°ContentViewï¼Œä¼šå‘ç°ä¸€ä¸ªå¥‡æ€ªçš„some viewï¼Œè¦è§£é‡Šè¿™ä¸ªæˆ‘ä»¬å°±éœ€è¦å…ˆäº†è§£ä¸‹Viewã€‚

Viewæ˜¯SwiftUIçš„æœ€æ ¸å¿ƒçš„ä¸€ä¸ªåè®®ï¼Œä»£è¡¨äº†ä¸€ä¸ªå±å¹•ä¸Šå…ƒç´ çš„æè¿°ã€‚è¿™ä¸ªåè®®ä¸­å«æœ‰ä¸€ä¸ª associatedtypeï¼š

```
public protocol View : _View {

    associatedtype Body : View

    var body: Self.Body { get }
}
```

è¿™ç§å¸¦æœ‰associatedtypeçš„åè®®ä¸èƒ½ä½œä¸ºç±»å‹æ¥ä½¿ç”¨ï¼Œè€Œåªèƒ½ä½œä¸ºç±»å‹çº¦æŸä½¿ç”¨ï¼Œå³ä¸èƒ½å†™æˆvar body: Viewå¦åˆ™ä¼šæŠ¥Errorï¼Œæç¤ºâ€œProtocol 'View' can only be used as a generic constraintâ€ã€‚
å…¶å®å¦‚æœæˆ‘ä»¬æŒ‡æ˜ Body çš„ç±»å‹ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä¾‹å¦‚

```
struct ContentView: View {
    var body: Text {
        Text("ä¸–ç•Œå’Œå¹³")
            .color(.purple)
    }
}
```
ä½†æ˜¯æœ‰ä¸ªé—®é¢˜å°±æ˜¯å¦‚æœæ¯æ¬¡ä¿®æ”¹Bodyçš„è¿”å›æ—¶ï¼Œæˆ‘ä»¬éƒ½éœ€è¦æ”¶åˆ°è°ƒæ•´ç›¸åº”çš„ç±»å‹ï¼Œä¼šå¾ˆéº»çƒ¦ä¹Ÿæ— å¿…è¦ã€‚ some View è¿™ç§å†™æ³•ä½¿ç”¨äº† Swift 5.1 çš„ Opaque return types ç‰¹æ€§ã€‚å®ƒå‘ç¼–è¯‘å™¨ä½œå‡ºä¿è¯ï¼Œæ¯æ¬¡ body å¾—åˆ°çš„ä¸€å®šæ˜¯æŸä¸€ä¸ªç¡®å®šçš„ï¼Œéµå®ˆ View åè®®çš„ç±»å‹ï¼Œä½†æ˜¯è¯·ç¼–è¯‘å™¨â€œç½‘å¼€ä¸€é¢â€ï¼Œä¸è¦å†ç»†ç©¶å…·ä½“çš„ç±»å‹ã€‚è¿™ä¸€ä¸ªç¼–è¯‘æœŸé—´çš„ç‰¹æ€§ï¼Œåœ¨ä¿è¯associatedtype protocolçš„åŠŸèƒ½çš„å‰æä¸‹ï¼Œä½¿ç”¨ some å¯ä»¥æŠ¹æ¶ˆå…·ä½“çš„ç±»å‹ã€‚è¿™ä¸ªç‰¹æ€§ç”¨åœ¨ SwiftUI ä¸Šç®€åŒ–äº†ä¹¦å†™éš¾åº¦ï¼Œè®©ä¸åŒ View å£°æ˜çš„è¯­æ³•ä¸Šæ›´åŠ ç»Ÿä¸€ã€‚


## ä¸‰ã€ æ€»ç»“

Flutter çœŸæ­£çš„è§£å†³äº†è·¨å¹³å°ï¼šiOS/Android/Web/Desktopï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿåªå­¦ä¹ ä¸€æ¬¡ï¼Œä¸ºå¤šå¹³å°ç¼–å†™åº”ç”¨ã€‚

SwiftUI ç›®å‰åªæ˜¯ä¸“æ³¨åœ¨è‹¹æœç”Ÿæ€ï¼Œè¿™æ˜¯ä¸€ä¸ªç¡¬ä¼¤ï¼Œä¸è¿‡ SwiftUI è¿˜å¤„åœ¨å©´å„¿é˜¶æ®µï¼Œæœªæ¥å°±çœ‹è‹¹æœæ˜¯å¦æƒ³è¦å»æ”¯æŒå…¶ä»–å¹³å°äº†ã€‚

 Flutter è¿™ä¹ˆå¥½ï¼Œè¿™ä¹ˆå¼ºå¤§,è™½ç„¶å‘¨è¾¹è®¾æ–½è¿˜ç®—æ˜¯æ¯”è¾ƒå®Œå–„ï¼Œæ–‡æ¡£ä¹Ÿè¿˜ç®—å¯ç”¨ï¼Œè€Œä¸”è¿™ä¸ªé¡¹ç›®ä¹Ÿå¯åŠ¨ä¸¤ä¸‰å¹´äº†,ä½†æ˜¯ Flutter è¿˜æ˜¯å¤„äºä¸€ä¸ªè¦å•¥å•¥æ²¡æœ‰çš„é˜¶æ®µã€‚çœŸçš„æ˜¯é™¤äº† View æ¸²æŸ“ï¼Œå•¥éƒ½æ²¡æœ‰ã€‚è¯´åˆ°æ€§èƒ½ä¸Šã€‚ äº‹å®ä¸Šèƒ½ä¿è¯çš„å¯èƒ½ä¹Ÿåªæœ‰ Android ä¸Šçš„æ€§èƒ½ã€‚ è‹¹æœå®¶çš„æ¸²æŸ“é€æ¸åœ¨å¾€ metal ä¸Šè¿ç§»ã€‚ æ€ä¹ˆè¯´å‘¢ï¼Œæ¯•ç«Ÿæ˜¯è‹¹æœè‡ªå·±å®¶çš„ä¸œè¥¿ï¼Œè€Œä¸”åˆä¸ç”¨åšå¾ˆå¤šçš„ç‰ˆæœ¬å…¼å®¹ï¼Œæ€§èƒ½æ€ä¹ˆæƒ³éƒ½ä¼šæ¯”åˆ«äººå®ç°çš„æ–¹æ¡ˆè¦å¥½å½“ç„¶ï¼ŒFlutter æ˜¯ä¸ªéå¸¸å¥½çš„å®è·µï¼Œå®ƒç›´æ¥ä»åº•å±‚ä¸Šå˜é©å¸Œæœ›èƒ½å¤Ÿç»Ÿä¸€å¤šå¹³å°ã€‚å¦‚æœ Google ç»™äºˆè¶³å¤Ÿçš„æ”¯æŒï¼Œè€Œä¸”è¶³å¤Ÿé•¿çš„æ—¶é—´ï¼Œ flutter ä¼šå‘å±•å¾—æ›´å¥½ï¼Œæœ€åçœŸçš„èƒ½ç»Ÿä¸€å¤šå¹³å°ä¹Ÿè¯´ä¸å®š.





